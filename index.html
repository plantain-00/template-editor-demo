<!DOCTYPE html>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="A template editor demo.">
<title>template-editor-demo</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:"Lucida Grande","Lucida Sans Unicode","Hiragino Sans GB","WenQuanYi Micro Hei","Verdana,Aril",sans-serif;-webkit-font-smoothing:antialiased}.schema-based-json-editor--card{padding:1.25rem;border:1px solid rgba(0,0,0,.125);border-radius:.25rem}button{margin:5px;padding:5px;border-radius:5px;cursor:pointer}input[type=number],input[type=text]{width:180px;padding:5px;margin:5px}/*!
 * "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License
 * https://github.com/simonwhitaker/github-fork-ribbon-css
*/.github-fork-ribbon{width:12.1em;height:12.1em;position:absolute;overflow:hidden;top:0;right:0;z-index:9999;pointer-events:none;font-size:13px;text-decoration:none;text-indent:-999999px}.github-fork-ribbon.fixed{position:fixed}.github-fork-ribbon:active,.github-fork-ribbon:hover{background-color:rgba(0,0,0,0)}.github-fork-ribbon:after,.github-fork-ribbon:before{position:absolute;display:block;width:15.38em;height:1.54em;top:3.23em;right:-3.23em;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.github-fork-ribbon:before{content:"";padding:.38em 0;background-color:#a00;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,0)),to(rgba(0,0,0,.15)));background-image:-webkit-linear-gradient(top,rgba(0,0,0,0),rgba(0,0,0,.15));background-image:-moz-linear-gradient(top,rgba(0,0,0,0),rgba(0,0,0,.15));background-image:-ms-linear-gradient(top,rgba(0,0,0,0),rgba(0,0,0,.15));background-image:-o-linear-gradient(top,rgba(0,0,0,0),rgba(0,0,0,.15));background-image:linear-gradient(to bottom,rgba(0,0,0,0),rgba(0,0,0,.15));-webkit-box-shadow:0 .15em .23em 0 rgba(0,0,0,.5);-moz-box-shadow:0 .15em .23em 0 rgba(0,0,0,.5);box-shadow:0 .15em .23em 0 rgba(0,0,0,.5);pointer-events:auto}.github-fork-ribbon:after{content:attr(data-ribbon);color:#fff;font:700 1em "Helvetica Neue",Helvetica,Arial,sans-serif;line-height:1.54em;text-decoration:none;text-shadow:0 -.08em rgba(0,0,0,.5);text-align:center;text-indent:0;padding:.15em 0;margin:.15em 0;border-width:.08em 0;border-style:dotted;border-color:#fff;border-color:rgba(255,255,255,.7)}.github-fork-ribbon.left-bottom,.github-fork-ribbon.left-top{right:auto;left:0}.github-fork-ribbon.left-bottom,.github-fork-ribbon.right-bottom{top:auto;bottom:0}.github-fork-ribbon.left-bottom:after,.github-fork-ribbon.left-bottom:before,.github-fork-ribbon.left-top:after,.github-fork-ribbon.left-top:before{right:auto;left:-3.23em}.github-fork-ribbon.left-bottom:after,.github-fork-ribbon.left-bottom:before,.github-fork-ribbon.right-bottom:after,.github-fork-ribbon.right-bottom:before{top:auto;bottom:3.23em}.github-fork-ribbon.left-top:after,.github-fork-ribbon.left-top:before,.github-fork-ribbon.right-bottom:after,.github-fork-ribbon.right-bottom:before{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}
</style>
<a class="github-fork-ribbon right-top" data-ribbon="Fork me on GitHub" href="https://github.com/plantain-00/template-editor-demo" title="Fork me on GitHub" target="_blank" rel="noopener">Fork me on GitHub</a>
<div id="prerender-container">
<div id="container"></div>
</div>
<script src="vendor.bundle-21092416683f2fa354f448d514906db4.js" crossOrigin="anonymous" integrity="sha256-iowl31naGZ6/6Vm/nuoKYgkjIuK60RTipjT+Os0e/Sw="></script>
<script>
!function(t){function e(e){for(var a,r,o=e[0],c=e[1],l=e[2],u=0,h=[];u<o.length;u++)r=o[u],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&h.push(i[r][0]),i[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);for(p&&p(e);h.length;)h.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},i={0:0},s=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var p=c;s.push([14,1]),n()}({14:function(t,e,n){"use strict";n.r(e);var a=n(0),i=n(1),s=n(2);n(9);function r(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{display:"flex","align-items":"center",height:"50px"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.styleGuideKey,expression:"styleGuideKey"}],attrs:{type:"text"},domProps:{value:t.styleGuideKey},on:{input:function(e){e.target.composing||(t.styleGuideKey=e.target.value)}}}),t._v(" "),n("button",{on:{click:function(e){return t.loadStyleGuide()}}},[t._v("load style guide")]),t._v(" "),n("button",{on:{click:function(e){return t.saveStyleGuide()}}},[t._v("save style guide")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.templateModelKey,expression:"templateModelKey"}],attrs:{type:"text"},domProps:{value:t.templateModelKey},on:{input:function(e){e.target.composing||(t.templateModelKey=e.target.value)}}}),t._v(" "),n("button",{on:{click:function(e){return t.loadTemplateModel()}}},[t._v("load template model")]),t._v(" "),n("button",{on:{click:function(e){return t.saveTemplateModel()}}},[t._v("save template model")]),t._v(" "),n("button",{on:{click:function(e){return t.editTemplateModel()}}},[t._v(t._s(t.appState.templateModelEditorVisible?"hide template model editor":"show template model editor"))]),t._v(" "),n("button",{on:{click:function(e){return t.generate()}}},[t._v(t._s(t.appState.graphicCanvasState?"back to template":"generate graphic"))])])}var o=[];function c(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{display:"flex","flex-direction":"column"}},[n("div",{staticStyle:{height:"50px"}},[n("app-panel",{attrs:{appState:t.appState}}),t._v(" "),n("template-model-editor",{attrs:{appState:t.appState}})],1),t._v(" "),t.appState.graphicCanvasState?n("template-editor",{attrs:{canvasState:t.appState.graphicCanvasState}}):t._e(),t._v(" "),n("template-editor",{directives:[{name:"show",rawName:"v-show",value:!t.appState.graphicCanvasState,expression:"!appState.graphicCanvasState"}],attrs:{canvasState:t.appState.canvasState}})],1)}var l=[];function p(){var t=this,e=t.$createElement,n=t._self._c||e;return t.canvasState.contextMenuEnabled?n("div",{on:{click:t.close}},[n("div",{style:t.maskStyle}),t._v(" "),n("div",{style:t.contextMenuStyle},[n("button",{on:{click:t.remove}},[t._v("remove")])])]):t._e()}var u=[];function h(){var t=this.$createElement,e=this._self._c||t;return this.canvasState.isDraggingForSelection?e("div",{style:this.draggingAreaStyle}):this._e()}var d=[];function v(){var t=this.$createElement;return(this._self._c||t)("div",{style:this.maskStyle,attrs:{tabindex:"0"},on:{wheel:this.wheel,mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,contextmenu:this.contextmenu,keydown:this.keydown}})}var f=[];function y(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{style:t.panelStyle},["content"===t.canvasState.selection.kind?n("div",["text"===t.canvasState.selection.content.kind?n("div",[t._v("\n      text\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.text},on:{change:t.changeText}}),t._v(" "),n("br"),t._v("\n      text f(x)\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.textExpression},on:{change:t.changeTextExpression}}),t._v(" "),n("br"),t._v("\n      font family\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.fontFamily},on:{change:t.changeFontFamily}}),t._v(" "),n("br"),t._v("\n      font size\n      "),n("input",{attrs:{type:"number"},domProps:{value:t.canvasState.selection.content.fontSize},on:{change:t.changeFontSize}}),t._v(" "),n("br"),t._v("\n      font size f(x)\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.fontSizeExpression},on:{change:t.changeFontSizeExpression}}),t._v(" "),n("br"),t._v("\n      color\n      "),n("input",{attrs:{type:"color"},domProps:{value:t.canvasState.selection.content.color},on:{change:t.changeColor}})]):t._e(),t._v(" "),"image"===t.canvasState.selection.content.kind?n("div",[t._v("\n      url\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.url},on:{change:t.changeImageUrl}}),t._v(" "),n("br"),t._v("\n      url f(x)\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.urlExpression},on:{change:t.changeImageUrlExpression}})]):t._e(),t._v(" "),n("div",[t._v("\n      x\n      "),n("input",{attrs:{type:"number"},domProps:{value:t.canvasState.selection.content.x},on:{change:function(e){return t.changePosition(e,"x")}}})]),t._v(" "),n("div",[t._v("\n      x f(x)\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.xExpression},on:{change:function(e){return t.changePositionExpression(e,"x")}}})]),t._v(" "),n("div",[t._v("\n      y\n      "),n("input",{attrs:{type:"number"},domProps:{value:t.canvasState.selection.content.y},on:{change:function(e){return t.changePosition(e,"y")}}})]),t._v(" "),n("div",[t._v("\n      y f(x)\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.yExpression},on:{change:function(e){return t.changePositionExpression(e,"y")}}})]),t._v(" "),"text"===t.canvasState.selection.content.kind||"image"===t.canvasState.selection.content.kind?n("div",[n("div",[t._v("\n        width\n        "),n("input",{attrs:{type:"number"},domProps:{value:t.canvasState.selection.content.width},on:{change:function(e){return t.changeSize(e,"width")}}})]),t._v(" "),n("div",[t._v("\n        width f(x)\n        "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.widthExpression},on:{change:function(e){return t.changeSizeExpression(e,"width")}}})]),t._v(" "),n("div",[t._v("\n        height\n        "),n("input",{attrs:{type:"number"},domProps:{value:t.canvasState.selection.content.height},on:{change:function(e){return t.changeSize(e,"height")}}})]),t._v(" "),n("div",[t._v("\n        height f(x)\n        "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.heightExpression},on:{change:function(e){return t.changeSizeExpression(e,"height")}}})])]):t._e(),t._v(" "),"snapshot"===t.canvasState.selection.content.kind?t._l(t.canvasState.selection.content.snapshot.contents,(function(e,a){return n("div",[n("div",{staticStyle:{cursor:"pointer"},on:{click:function(n){return t.selectContent(e)}}},[t._v("content "+t._s(a)+": "+t._s(e.kind))])])})):t._e(),t._v(" "),n("div",[t._v("\n      hidden\n      "),n("input",{attrs:{type:"checkbox"},domProps:{checked:t.canvasState.selection.content.hidden},on:{change:t.changeHidden}})]),t._v(" "),n("div",[t._v("\n      if\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.if},on:{change:t.changeIf}})]),t._v(" "),n("div",[t._v("\n      repeat\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.repeat},on:{change:t.changeRepeat}})]),t._v(" "),"reference"===t.canvasState.selection.content.kind?n("div",[t._v("\n      props\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.content.props},on:{change:t.changeProps}})]):t._e(),t._v(" "),"text"===t.canvasState.selection.content.kind||"image"===t.canvasState.selection.content.kind?n("div",[n("button",{on:{click:function(e){return t.extractAsSymbol()}}},[t._v("extract as symbol")])]):t._e()],2):t._e(),t._v(" "),"template"===t.canvasState.selection.kind?n("div",[n("div",[t._v("\n      x\n      "),n("input",{attrs:{type:"number"},domProps:{value:t.canvasState.selection.template.x},on:{change:function(e){return t.changePosition(e,"x")}}})]),t._v(" "),n("div",[t._v("\n      y\n      "),n("input",{attrs:{type:"number"},domProps:{value:t.canvasState.selection.template.y},on:{change:function(e){return t.changePosition(e,"y")}}})]),t._v(" "),n("div",[t._v("\n      width\n      "),n("input",{attrs:{type:"number"},domProps:{value:t.canvasState.selection.template.width},on:{change:function(e){return t.changeSize(e,"width")}}})]),t._v(" "),n("div",[t._v("\n      width f(x)\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.template.widthExpression},on:{change:function(e){return t.changeSizeExpression(e,"width")}}})]),t._v(" "),n("div",[t._v("\n      height\n      "),n("input",{attrs:{type:"number"},domProps:{value:t.canvasState.selection.template.height},on:{change:function(e){return t.changeSize(e,"height")}}})]),t._v(" "),n("div",[t._v("\n      height f(x)\n      "),n("input",{attrs:{type:"text"},domProps:{value:t.canvasState.selection.template.heightExpression},on:{change:function(e){return t.changeSizeExpression(e,"height")}}})]),t._v(" "),t._l(t.canvasState.selection.template.contents,(function(e,a){return n("div",[n("div",{staticStyle:{cursor:"pointer"},on:{click:function(n){return t.selectContent(e)}}},[t._v("content "+t._s(a)+": "+t._s(e.kind))])])})),t._v(" "),n("div",[t._v("\n      display\n      "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.canvasState.selection.template.display,expression:"canvasState.selection.template.display"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.canvasState.selection.template,"display",e.target.multiple?n:n[0])}}},[n("option",{domProps:{value:void 0}}),t._v(" "),n("option",{attrs:{value:"flex"}},[t._v("flex")])])]),t._v(" "),n("div",[t._v("\n      flex direction\n      "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.canvasState.selection.template.flexDirection,expression:"canvasState.selection.template.flexDirection"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.canvasState.selection.template,"flexDirection",e.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"row"}},[t._v("row")]),t._v(" "),n("option",{attrs:{value:"column"}},[t._v("column")])])]),t._v(" "),n("div",[t._v("\n      justify content\n      "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.canvasState.selection.template.justifyContent,expression:"canvasState.selection.template.justifyContent"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.canvasState.selection.template,"justifyContent",e.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"start"}},[t._v("start")]),t._v(" "),n("option",{attrs:{value:"end"}},[t._v("end")]),t._v(" "),n("option",{attrs:{value:"center"}},[t._v("center")]),t._v(" "),n("option",{attrs:{value:"between"}},[t._v("between")])])]),t._v(" "),n("div",[t._v("\n      align items\n      "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.canvasState.selection.template.alignItems,expression:"canvasState.selection.template.alignItems"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.canvasState.selection.template,"alignItems",e.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"start"}},[t._v("start")]),t._v(" "),n("option",{attrs:{value:"end"}},[t._v("end")]),t._v(" "),n("option",{attrs:{value:"center"}},[t._v("center")])])]),t._v(" "),n("div",[n("button",{on:{click:function(e){return t.renderToImage()}}},[t._v("render to image")]),t._v(" "),t.imageUrl?n("img",{staticStyle:{"object-fit":"contain",width:"100%"},attrs:{src:t.imageUrl}}):t._e()])],2):t._e(),t._v(" "),n("div",[n("button",{on:{click:function(e){return t.debug()}}},[t._v("debug")])]),t._v(" "),n("div",[n("button",{on:{click:function(e){return t.addTemplate()}}},[t._v("add template")]),t._v(" "),n("button",{on:{click:function(e){return t.addText()}}},[t._v("add text")]),t._v(" "),n("button",{on:{click:function(e){return t.addImage()}}},[t._v("add image")])])])}var m=[];function g(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{style:t.canvasStyle},[n("div",{style:t.styleGuideStyle},[t._l(t.canvasState.styleGuide.templates,(function(e){return[n("div",{style:{left:e.x+"px",top:e.y+"px",position:"absolute"}},[n("template-renderer",{attrs:{template:e,templates:t.canvasState.styleGuide.templates}})],1)]}))],2)])}var S=[];function x(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{style:t.canvasStyle},[n("div",{style:t.styleGuideStyle},[t._l(t.selectionAreas,(function(e){return[n("div",{style:t.getSelectionAreaStyle(e)})]}))],2)])}var b=[];function w(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{display:"flex"}},[n("div",{style:t.canvasStyle},[n("render-layer",{attrs:{canvasState:t.canvasState}}),t._v(" "),n("selection-layer",{attrs:{canvasState:t.canvasState}}),t._v(" "),n("dragging-for-selection-layer",{attrs:{canvasState:t.canvasState}}),t._v(" "),n("mask-layer",{attrs:{canvasState:t.canvasState}}),t._v(" "),n("context-menu",{attrs:{canvasState:t.canvasState}})],1),t._v(" "),n("div",{staticStyle:{width:"300px",right:"0",position:"absolute"}},[n("operation-panel",{attrs:{canvasState:t.canvasState}})],1)])}var O=[];function _(){var t=this,e=t.$createElement,n=t._self._c||e;return t.appState.templateModelEditorVisible?n("div",{style:t.editorStyle},[n("json-editor",{attrs:{schema:t.schema,"initial-value":t.appState.templateModel},on:{"update-value":function(e){return t.updateValue(e)}}})],1):t._e()}var j=[];function k(t,e){if("reference"===t.kind){var n=e.find((function(e){return e.id===t.id}));return n||{width:0,height:0}}return"snapshot"===t.kind?t.snapshot:t}var G=n(3);function P(t){return Array.from(t).map((function(t){return{text:t}}))}function M(t,e,n){try{return Object(G.a)(Object(G.c)(Object(G.f)(t)),e)}catch(t){return void(n&&console[n](t))}}function Y(t,e,n,a){var i=e[t+"Expression"];if(i){var s=M(i,n,a);if("number"==typeof s)return s}return e[t]}function X(t,e,n,a){var i=e[t+"Expression"];if(i){var s=M(i,n,a);if("number"==typeof s)return s}return e[t]}function E(t,e,n){if(t.urlExpression){var a=M(t.urlExpression,e,n);if("string"==typeof a)return a}return t.url}function z(t,e,n){if(t.textExpression){var a=M(t.textExpression,e,n);if("string"==typeof a&&t.text!==a)return{text:a,characters:P(a)}}return{text:t.text,characters:t.characters}}function C(t,e,n){if(t.fontSizeExpression){var a=M(t.fontSizeExpression,e,n);if("number"==typeof a)return a}return t.fontSize}function H(t,e,n){var i=Object(a.a)(Object(a.a)({},t),{x:0,y:0,contents:t.contents.map((function(t){return function t(e,n,i){if("snapshot"===e.kind)return[e];if(e.repeat){var s=function(t){var e=t.indexOf(" in ");if(-1===e)return{expression:t};var n=t.substring(0,e).trim(),a=t.substring(e+4).trim();if(n.startsWith("(")&&n.endsWith(")")){var i=n.substring(1,n.length-1).split(",");return 0===i.length?{expression:a}:1===i.length?{expression:a,itemName:i[0].trim()}:{expression:a,itemName:i[0].trim(),indexName:i[1].trim()}}return{expression:a,itemName:n}}(e.repeat),r=s.expression,o=s.itemName,c=s.indexName,l=M(r,i,"error");if(Array.isArray(l)){for(var p=[],u=0;u<l.length;u++){var h=Object(a.a)({},i);o&&(h[o]=l[u],c&&(h[c]=u)),p.push.apply(p,Object(a.g)(t(Object(a.a)(Object(a.a)({},e),{repeat:void 0}),n,h)))}return p}}if(e.if){if(!1===(l=M(e.if,i,"error")))return[]}e=Object(a.a)({},e);e.x=X("x",e,i,"error");e.y=X("y",e,i,"error");if("reference"===e.kind){var d=e.id,v=n.templates.find((function(t){return t.id===d}));if(v){if(e.props){l=M(e.props,i,"error");i=Object(a.a)(Object(a.a)({},i),{props:l})}return[{kind:"snapshot",x:e.x,y:e.y,snapshot:H(v,n,i)}]}return[]}e.width=Y("width",e,i,"error");e.height=Y("height",e,i,"error");if("text"===e.kind){var f=z(e,i,"error");e.text=f.text,e.characters=f.characters,e.fontSize=C(e,i,"error")}"image"===e.kind&&(e.url=E(e,i,"error"));return[Object(a.a)({},e)]}(t,e,n)})).flat()});return i.width=Y("width",i,n,"error"),i.height=Y("height",i,n,"error"),function t(e,n){var i,s;if("flex"===e.display)for(var r=e.flexDirection||"row",o=e.justifyContent||"start",c=e.alignItems||"start",l=function(t){var a=e.contents[t],i=k(a,n),s="row"===r?"x":"y",l="row"===r?"width":"height",p="row"===r?"y":"x",u="row"===r?"height":"width",h=e.contents.reduce((function(t,e){return t+k(e,n)[l]}),0);"start"===o?a[s]=0:"end"===o?a[s]=e[l]-h:"center"===o?a[s]=(e[l]-h)/2:e.contents.length>1?a[s]=t*Math.max(0,(e[l]-h)/(e.contents.length-1)):a[s]=0;for(var d=0;d<t;d++)a[s]+=k(e.contents[d],n)[l];a[p]="start"===c?0:"end"===c?e[u]-i[u]:(e[u]-i[u])/2},p=0;p<e.contents.length;p++)l(p);var u=function(e){if("reference"===e.kind){var a=n.find((function(t){return t.id===e.id}));a&&t(a,n)}else"snapshot"===e.kind&&t(e.snapshot,n)};try{for(var h=Object(a.h)(e.contents),d=h.next();!d.done;d=h.next()){u(d.value)}}catch(t){i={error:t}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}}}(i,e.templates),i}var T={name:"test",templates:[{id:"1",x:0,y:0,width:500,height:300,contents:[{kind:"text",text:"test",fontFamily:"serif",fontSize:50,color:"#FF0000",width:100,height:100,x:10,y:10,characters:[{text:"t"},{text:"e"},{text:"s"},{text:"t"}]},{kind:"image",url:"https://mdn.mozillademos.org/files/6457/mdn_logo_only_color.png",width:100,height:100,x:210,y:10}]},{id:"2",x:600,y:0,width:1100,height:400,contents:[{kind:"reference",id:"1",x:10,y:10},{kind:"reference",id:"1",x:550,y:10}]}]},F=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.styleGuide={name:"",templates:[]},e.styleGuideTranslateX=0,e.styleGuideTranslateY=0,e.styleGuideScale=1,e.canvasWidth=1200,e.canvasHeight=400,e.selection={kind:"none"},e.mousedownX=0,e.mousedownY=0,e.mouseupX=0,e.mouseupY=0,e.mousePressing=!1,e.isDraggingForMoving=!1,e.contextMenuEnabled=!1,e.contextMenuX=0,e.contextMenuY=0,e._styleGuideWidth=0,e._styleGuideHeight=0,e.styleGuideHistory=[],e}var n;return Object(a.d)(e,t),n=e,e.create=function(t,e,a){var i=new n;return i.styleGuide=t,i.canvasWidth=e,i.canvasHeight=a,i.applyCanvasSizeChange(),i},e.prototype.applyCanvasSizeChange=function(){var t=this.canvasWidth/this.styleGuideWidth,e=this.canvasHeight/this.styleGuideHeight;this.styleGuideScale=.9*Math.min(t,e);var n=this.styleGuideWidth*(t-this.styleGuideScale)/2,a=this.styleGuideHeight*(e-this.styleGuideScale)/2;this.styleGuideTranslateX=(n-this.styleGuideX*this.styleGuideScale-this.styleGuideWidth/2)/this.styleGuideScale+this.styleGuideWidth/2,this.styleGuideTranslateY=(a-this.styleGuideY*this.styleGuideScale-this.styleGuideHeight/2)/this.styleGuideScale+this.styleGuideHeight/2},Object.defineProperty(e.prototype,"styleGuideX",{get:function(){return Math.min.apply(Math,Object(a.g)(this.styleGuide.templates.map((function(t){return t.x}))))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styleGuideWidth",{get:function(){if(this.isDraggingForMoving)return this._styleGuideWidth;var t=Math.max.apply(Math,Object(a.g)(this.styleGuide.templates.map((function(t){return t.x+t.width})))),e=Math.max(t-this.styleGuideX,10);return this._styleGuideWidth=e,e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styleGuideY",{get:function(){return Math.min.apply(Math,Object(a.g)(this.styleGuide.templates.map((function(t){return t.y}))))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styleGuideHeight",{get:function(){if(this.isDraggingForMoving)return this._styleGuideHeight;var t=Math.max.apply(Math,Object(a.g)(this.styleGuide.templates.map((function(t){return t.y+t.height})))),e=Math.max(t-this.styleGuideY,10);return this._styleGuideHeight=e,e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDraggingForSelection",{get:function(){return this.moved&&this.mousePressing&&!this.isDraggingForMoving},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"moved",{get:function(){return!W(this.mouseupX,this.mousedownX)||!W(this.mouseupY,this.mousedownY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mousedownMappedX",{get:function(){return this.mapX(this.mousedownX)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mousedownMappedY",{get:function(){return this.mapY(this.mousedownY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseupMappedX",{get:function(){return this.mapX(this.mouseupX)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseupMappedY",{get:function(){return this.mapY(this.mouseupY)},enumerable:!0,configurable:!0}),e.prototype.mapX=function(t){return(t-((this.styleGuideTranslateX-this.styleGuideWidth/2)*this.styleGuideScale+this.styleGuideWidth/2))/this.styleGuideScale},e.prototype.mapY=function(t){return(t-((this.styleGuideTranslateY-this.styleGuideHeight/2)*this.styleGuideScale+this.styleGuideHeight/2))/this.styleGuideScale},e.prototype.action=function(){this.styleGuideHistory.push(JSON.parse(JSON.stringify(this.styleGuide))),this.styleGuideHistory.length>10&&this.styleGuideHistory.splice(0,this.styleGuideHistory.length-10)},e.prototype.undo=function(){var t=this.styleGuideHistory.pop();t&&(this.styleGuide=t)},e=n=Object(a.c)([s.a],e)}(i.a);function W(t,e){var n=t-e;return n<Number.EPSILON&&n>-Number.EPSILON}var K=300,A=50,N=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.templateModel={categories:[]},e.templateModelEditorVisible=!1,e.canvasState=F.create(T,window.innerWidth-K,window.innerHeight-A),e.graphicCanvasState=null,e}return Object(a.d)(e,t),e.prototype.resize=function(){this.canvasState.canvasWidth=window.innerWidth-K,this.canvasState.canvasHeight=window.innerHeight-A,this.canvasState.applyCanvasSizeChange(),this.graphicCanvasState&&(this.graphicCanvasState.canvasWidth=window.innerWidth-K,this.graphicCanvasState.canvasHeight=window.innerHeight-A,this.graphicCanvasState.applyCanvasSizeChange())},e.prototype.loadGraphicCanvas=function(t){this.graphicCanvasState=F.create({name:"",templates:[t]},window.innerWidth-K,window.innerHeight-A),this.graphicCanvasState.selection={kind:"template",template:t}},e=Object(a.c)([s.a],e)}(i.a),D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.styleGuideKey="kfc.json",e.templateModelKey="kfc-model.json",e}return Object(a.d)(e,t),e.prototype.loadStyleGuide=function(){return Object(a.b)(this,void 0,void 0,(function(){var t;return Object(a.e)(this,(function(e){switch(e.label){case 0:return this.styleGuideKey?[4,fetch("https://storage.yorkyao.xyz/"+this.styleGuideKey)]:[3,3];case 1:return[4,e.sent().json()];case 2:t=e.sent(),this.appState.canvasState.styleGuide=t,this.appState.canvasState.applyCanvasSizeChange(),e.label=3;case 3:return[2]}}))}))},e.prototype.saveStyleGuide=function(){return Object(a.b)(this,void 0,void 0,(function(){return Object(a.e)(this,(function(t){switch(t.label){case 0:return this.styleGuideKey?[4,fetch("https://storage.yorkyao.xyz/"+this.styleGuideKey,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.appState.canvasState.styleGuide)})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.loadTemplateModel=function(){return Object(a.b)(this,void 0,void 0,(function(){var t;return Object(a.e)(this,(function(e){switch(e.label){case 0:return this.templateModelKey?[4,fetch("https://storage.yorkyao.xyz/"+this.templateModelKey)]:[3,3];case 1:return[4,e.sent().json()];case 2:t=e.sent(),this.appState.templateModel=t,e.label=3;case 3:return[2]}}))}))},e.prototype.saveTemplateModel=function(){return Object(a.b)(this,void 0,void 0,(function(){return Object(a.e)(this,(function(t){switch(t.label){case 0:return this.templateModelKey?[4,fetch("https://storage.yorkyao.xyz/"+this.templateModelKey,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.appState.templateModel)})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.editTemplateModel=function(){this.appState.templateModelEditorVisible=!this.appState.templateModelEditorVisible},e.prototype.generate=function(){this.appState.graphicCanvasState?this.appState.graphicCanvasState=null:"template"===this.appState.canvasState.selection.kind&&this.appState.loadGraphicCanvas(H(this.appState.canvasState.selection.template,this.appState.canvasState.styleGuide,this.appState.templateModel))},e=Object(a.c)([Object(s.a)({render:r,staticRenderFns:o,props:{appState:N}})],e)}(i.a),I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.schema={type:"object",properties:{categories:{type:"array",items:{type:"object",properties:{name:{type:"string"},id:{type:"string"},commodities:{type:"array",items:{type:"object",properties:{name:{type:"string"},id:{type:"string"},description:{type:"string"},image:{type:"string"},prices:{type:"array",items:{type:"string"}}},required:["id","name","prices","description","image"],collapsed:!0}}},required:["id","name","commodities"],collapsed:!0}}},required:["categories"]},e.editorStyle={position:"absolute",right:"0px",left:"0px",top:"50px",backgroundColor:"white",zIndex:1,height:e.appState.canvasState.canvasHeight+"px",overflow:"auto"},e}return Object(a.d)(e,t),e.prototype.updateValue=function(t){t.isValid&&(this.appState.templateModel=t.value)},e=Object(a.c)([Object(s.a)({render:_,staticRenderFns:j,props:{appState:N}})],e)}(i.a);function R(t,e,n){var i=document.createElement("canvas");i.width=t.width,i.height=t.height;var s=i.getContext("2d");return s.fillStyle="white",s.fillRect(0,0,t.width,t.height),function t(e,n,i,s,r){var o,c;try{for(var l=Object(a.h)(q(n,i)),p=l.next();!p.done;p=l.next()){var u=p.value,h=X("x",u.content,{props:r}),d=X("y",u.content,{props:r});if("text"===u.kind){var v=u.content;e.fillStyle=v.color,e.textBaseline="top";var f=r?C(v,{props:r}):v.fontSize;e.font=f+"px "+v.fontFamily;var y=r?z(v,{props:r}).characters:v.characters;e.fillText(y.map((function(t){return t.text})).join(""),h,d)}else if("image"===u.kind){v=u.content;var m=r?E(v,{props:r}):v.url,g=r?Y("width",v,{props:r}):v.width,S=r?Y("height",v,{props:r}):v.height;e.drawImage(s[m],h,d,g,S)}else if("symbol"===u.kind){e.save(),e.translate(h,d);var x=u.props?M(u.props,{props:r}):void 0;t(e,u.symbol,i,s,x),e.restore()}}}catch(t){o={error:t}}finally{try{p&&!p.done&&(c=l.return)&&c.call(l)}finally{if(o)throw o.error}}}(s,t,e,n),i.toDataURL()}function $(t,e){return Object(a.b)(this,void 0,void 0,(function(){var n,i,s,r,o;return Object(a.e)(this,(function(c){switch(c.label){case 0:return function t(e,n,i){var s,r;var o=function(e){if(e.hidden)return"continue";if("image"===e.kind){if(i[e.url])return"continue";i[e.url]=new Promise((function(t){var n=document.createElement("img");n.crossOrigin="anonymous",n.onload=function(){t(n)},n.src=e.url+"?random="+Math.random()}))}else if("reference"===e.kind){var a=n.find((function(t){return t.id===e.id}));a&&t(a,n,i)}else"snapshot"===e.kind&&t(e.snapshot,n,i)};try{for(var c=Object(a.h)(e.contents),l=c.next();!l.done;l=c.next()){var p=l.value;o(p)}}catch(t){s={error:t}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(s)throw s.error}}}(t,e,n={}),i=Object.keys(n).map((function(t){return{url:t,resource:n[t]}})),[4,Promise.all(i.map((function(t){return t.resource})))];case 1:for(s=c.sent(),r={},o=0;o<i.length;o++)r[i[o].url]=s[o];return[2,r]}}))}))}var U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(e,t),e.prototype.render=function(t){return t("div",{style:{width:this.template.width+"px",height:this.template.height+"px",position:"absolute",userSelect:"none",backgroundColor:"white"}},[t("symbol-renderer",{props:{template:this.template,templates:this.templates,position:{x:0,y:0}}})])},e=Object(a.c)([Object(s.a)({props:["template","templates"]})],e)}(i.a),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this.props?Y("width",this.template,{props:this.props}):this.template.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.props?Y("height",this.template,{props:this.props}):this.template.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.positionProps?X("x",this.position,{props:this.positionProps}):this.position.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.positionProps?X("y",this.position,{props:this.positionProps}):this.position.y},enumerable:!0,configurable:!0}),e.prototype.render=function(t){var e,n,i=[];try{for(var s=Object(a.h)(q(this.template,this.templates)),r=s.next();!r.done;r=s.next()){var o=r.value;if("text"===o.kind)i.push(t("text-renderer",{props:{content:o.content,props:this.props}}));else if("image"===o.kind)i.push(t("image-renderer",{props:{content:o.content,props:this.props}}));else if("symbol"===o.kind){var c=o.content,l=o.props?M(o.props,{props:this.props}):void 0;i.push(t("symbol-renderer",{props:{template:o.symbol,templates:this.templates,props:l,position:c,positionProps:this.props}}))}}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return t("div",{style:{width:this.width+"px",height:this.height+"px",left:this.x+"px",top:this.y+"px",position:"absolute",userSelect:"none"}},i)},e=Object(a.c)([Object(s.a)({props:["template","templates","props","position","positionProps"]})],e)}(i.a);i.a.component("symbol-renderer",J);var V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"characters",{get:function(){return this.props?z(this.content,{props:this.props}).characters:this.content.characters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.props?C(this.content,{props:this.props}):this.content.fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.props?X("x",this.content,{props:this.props}):this.content.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.props?X("y",this.content,{props:this.props}):this.content.y},enumerable:!0,configurable:!0}),e.prototype.render=function(t){return t("div",{style:{color:this.content.color,fontSize:this.fontSize+"px",fontFamily:this.content.fontFamily,position:"absolute",left:this.x+"px",top:this.y+"px"}},this.characters.map((function(t){return t.text})).join(""))},e=Object(a.c)([Object(s.a)({props:["content","props"]})],e)}(i.a);i.a.component("text-renderer",V);var L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"url",{get:function(){return this.props?E(this.content,{props:this.props}):this.content.url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.props?Y("width",this.content,{props:this.props}):this.content.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.props?Y("height",this.content,{props:this.props}):this.content.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.props?X("x",this.content,{props:this.props}):this.content.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.props?X("y",this.content,{props:this.props}):this.content.y},enumerable:!0,configurable:!0}),e.prototype.render=function(t){return t("img",{style:{width:this.width+"px",height:this.height+"px",position:"absolute",left:this.x+"px",top:this.y+"px"},attrs:{src:this.url}})},e=Object(a.c)([Object(s.a)({props:["content","props"]})],e)}(i.a);function q(t,e){var n,i,s,r,o,c,l;return Object(a.e)(this,(function(p){switch(p.label){case 0:n=function(t){var n;return Object(a.e)(this,(function(a){switch(a.label){case 0:return t.hidden?[2,"continue"]:"text"!==t.kind?[3,2]:[4,{kind:"text",content:t}];case 1:return a.sent(),[3,9];case 2:return"image"!==t.kind?[3,4]:[4,{kind:"image",content:t}];case 3:return a.sent(),[3,9];case 4:return"reference"!==t.kind?[3,7]:(n=e.find((function(e){return e.id===t.id})))?[4,{kind:"symbol",content:t,symbol:n,props:t.props}]:[3,6];case 5:a.sent(),a.label=6;case 6:return[3,9];case 7:return"snapshot"!==t.kind?[3,9]:[4,{kind:"symbol",content:t,symbol:t.snapshot}];case 8:a.sent(),a.label=9;case 9:return[2]}}))},p.label=1;case 1:p.trys.push([1,6,7,8]),i=Object(a.h)(t.contents),s=i.next(),p.label=2;case 2:return s.done?[3,5]:(r=s.value,[5,n(r)]);case 3:p.sent(),p.label=4;case 4:return s=i.next(),[3,2];case 5:return[3,8];case 6:return o=p.sent(),c={error:o},[3,8];case 7:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}return[7];case 8:return[2]}}))}i.a.component("image-renderer",L);var B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"canvasStyle",{get:function(){return{position:"absolute",width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",overflow:"hidden",backgroundColor:"#ddd"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styleGuideStyle",{get:function(){return{transform:"scale("+this.canvasState.styleGuideScale+") translate("+this.canvasState.styleGuideTranslateX+"px, "+this.canvasState.styleGuideTranslateY+"px)",width:this.canvasState.styleGuideWidth+"px",height:this.canvasState.styleGuideHeight+"px"}},enumerable:!0,configurable:!0}),e=Object(a.c)([Object(s.a)({render:g,staticRenderFns:S,props:{canvasState:F}})],e)}(i.a);i.a.component("template-renderer",U);var Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"draggingAreaStyle",{get:function(){return{position:"absolute",border:"1px dashed black",left:Math.min(this.canvasState.mousedownX,this.canvasState.mouseupX)+"px",top:Math.min(this.canvasState.mousedownY,this.canvasState.mouseupY)+"px",width:Math.abs(this.canvasState.mousedownX-this.canvasState.mouseupX)+"px",height:Math.abs(this.canvasState.mousedownY-this.canvasState.mouseupY)+"px"}},enumerable:!0,configurable:!0}),e=Object(a.c)([Object(s.a)({render:h,staticRenderFns:d,props:{canvasState:F}})],e)}(i.a);function Z(t,e){var n,i,s,r,o,c;return Object(a.e)(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,7]),n=Object(a.h)(e.templates),i=n.next(),l.label=1;case 1:return i.done?[3,4]:(s=i.value,[5,Object(a.h)(nt(t,s,{x:s.x,y:s.y},e))]);case 2:l.sent(),l.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return r=l.sent(),o={error:r},[3,7];case 6:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}}))}function tt(t,e,n){var i,s,r,o,c,l;return Object(a.e)(this,(function(p){switch(p.label){case 0:return n?[5,Object(a.h)(at(t,n,{x:n.x,y:n.y},e))]:[3,2];case 1:return p.sent(),[2];case 2:p.trys.push([2,7,8,9]),i=Object(a.h)(e.templates),s=i.next(),p.label=3;case 3:return s.done?[3,6]:(r=s.value,[5,Object(a.h)(at(t,r,{x:r.x,y:r.y},e))]);case 4:p.sent(),p.label=5;case 5:return s=i.next(),[3,3];case 6:return[3,9];case 7:return o=p.sent(),c={error:o},[3,9];case 8:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}return[7];case 9:return[2]}}))}function et(t,e){return Array.isArray(t)?t.every((function(t){return et(t,e)})):t.x>=e.x&&t.y>=e.y&&t.x<=e.x+e.width&&t.y<=e.y+e.height}function nt(t,e,n,i){var s,r,o,c,l,p,u;return Object(a.e)(this,(function(h){switch(h.label){case 0:return e!==t?[3,2]:[4,n];case 1:return h.sent(),[3,10];case 2:s=function(e){var s;return Object(a.e)(this,(function(r){switch(r.label){case 0:return"reference"!==e.kind?[3,2]:(s=i.templates.find((function(t){return t.id===e.id})))?[5,Object(a.h)(nt(t,s,{x:e.x+n.x,y:e.y+n.y,content:e},i))]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))},h.label=3;case 3:h.trys.push([3,8,9,10]),r=Object(a.h)(e.contents),o=r.next(),h.label=4;case 4:return o.done?[3,7]:(c=o.value,[5,s(c)]);case 5:h.sent(),h.label=6;case 6:return o=r.next(),[3,4];case 7:return[3,10];case 8:return l=h.sent(),p={error:l},[3,10];case 9:try{o&&!o.done&&(u=r.return)&&u.call(r)}finally{if(p)throw p.error}return[7];case 10:return[2]}}))}function at(t,e,n,i){var s,r;return Object(a.e)(this,(function(o){switch(o.label){case 0:s=function(s){var r,o;return Object(a.e)(this,(function(c){switch(c.label){case 0:return(r=e.contents[s])!==t?[3,2]:[4,{x:n.x+r.x,y:n.y+r.y,index:s,contents:e.contents}];case 1:return c.sent(),[3,7];case 2:return"reference"!==r.kind?[3,5]:(o=i.templates.find((function(t){return t.id===r.id})))?[5,Object(a.h)(at(t,o,{x:r.x+n.x,y:r.y+n.y},i))]:[3,4];case 3:c.sent(),c.label=4;case 4:return[3,7];case 5:return"snapshot"!==r.kind?[3,7]:[5,Object(a.h)(at(t,r.snapshot,{x:r.x+n.x,y:r.y+n.y},i))];case 6:c.sent(),c.label=7;case 7:return[2]}}))},r=0,o.label=1;case 1:return r<e.contents.length?[5,s(r)]:[3,4];case 2:o.sent(),o.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}var it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"selectionAreas",{get:function(){if("template"===this.canvasState.selection.kind){var t=this.canvasState.selection.template;return Array.from(Z(t,this.canvasState.styleGuide)).map((function(e){return{x:e.x,y:e.y,width:t.width,height:t.height}}))}if("content"===this.canvasState.selection.kind){var e=this.canvasState.selection.content,n=void 0;if(n="reference"===e.kind?this.canvasState.styleGuide.templates.find((function(t){return t.id===e.id})):"snapshot"===e.kind?e.snapshot:e){var a=n;return Array.from(tt(e,this.canvasState.styleGuide)).map((function(t){return{x:t.x,y:t.y,width:a.width,height:a.height}}))}}return[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvasStyle",{get:function(){return{position:"absolute",width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",overflow:"hidden"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styleGuideStyle",{get:function(){return{transform:"scale("+this.canvasState.styleGuideScale+") translate("+this.canvasState.styleGuideTranslateX+"px, "+this.canvasState.styleGuideTranslateY+"px)",width:this.canvasState.styleGuideWidth+"px",height:this.canvasState.styleGuideHeight+"px"}},enumerable:!0,configurable:!0}),e.prototype.getSelectionAreaStyle=function(t){return{left:t.x+"px",top:t.y+"px",width:t.width+"px",height:t.height+"px",position:"absolute",border:1/this.canvasState.styleGuideScale+"px solid green"}},e=Object(a.c)([Object(s.a)({render:x,staticRenderFns:b,props:{canvasState:F}})],e)}(i.a),st=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.draggingSelectionOffsetX=0,e.draggingSelectionOffsetY=0,e.x=0,e.y=0,e.clipboard={kind:"none"},e}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"maskStyle",{get:function(){var t;return t=this.getSelectionAreaRelation({x:this.canvasState.mapX(this.x),y:this.canvasState.mapY(this.y)})||this.canvasState.isDraggingForMoving?"move":this.canvasState.isDraggingForSelection?"crosshair":"auto",{position:"absolute",width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",opacity:0,cursor:t}},enumerable:!0,configurable:!0}),e.prototype.wheel=function(t){if(t.ctrlKey){t.preventDefault(),t.stopImmediatePropagation();var e=1;t.deltaY>0?e=.98*this.canvasState.styleGuideScale:t.deltaY<0&&(e=this.canvasState.styleGuideScale/.98);var n=(t.offsetX-this.canvasState.mapX(t.offsetX)*e-this.canvasState.styleGuideWidth/2)/e+this.canvasState.styleGuideWidth/2,a=(t.offsetY-this.canvasState.mapY(t.offsetY)*e-this.canvasState.styleGuideHeight/2)/e+this.canvasState.styleGuideHeight/2;this.canvasState.styleGuideScale=e,this.canvasState.styleGuideTranslateX=n,this.canvasState.styleGuideTranslateY=a}else this.canvasState.styleGuideTranslateX-=t.deltaX/this.canvasState.styleGuideScale,this.canvasState.styleGuideTranslateY-=t.deltaY/this.canvasState.styleGuideScale},e.prototype.mousedown=function(t){if(this.canvasState.addKind){this.canvasState.action();var e=this.canvasState.mapX(t.offsetX),n=this.canvasState.mapY(t.offsetY);if("template"===this.canvasState.addKind){var a={id:Math.random().toString(),x:e-250,y:n-150,width:500,height:300,contents:[]};this.canvasState.styleGuide.templates.push(a),this.canvasState.selection={kind:"template",template:a}}else{var i=rt(this.canvasState.styleGuide,{x:e,y:n});if(i)if("text"===this.canvasState.addKind){var s={kind:"text",text:"",color:"#000000",fontFamily:"Aria",fontSize:12,x:e-i.x-50,y:n-i.y-50,width:100,height:100,characters:[]};i.contents.push(s),this.canvasState.selection={kind:"content",content:s,template:i}}else if("image"===this.canvasState.addKind){s={kind:"image",url:"",x:e-i.x-50,y:n-i.y-50,width:100,height:100};i.contents.push(s),this.canvasState.selection={kind:"content",content:s,template:i}}}this.canvasState.addKind=void 0}else{this.canvasState.mousedownX=t.offsetX,this.canvasState.mousedownY=t.offsetY,this.canvasState.mouseupX=t.offsetX,this.canvasState.mouseupY=t.offsetY,this.canvasState.mousePressing=!0;var r=this.getSelectionAreaRelation({x:this.canvasState.mousedownMappedX,y:this.canvasState.mousedownMappedY});this.canvasState.isDraggingForMoving=!!r,r&&(this.draggingSelectionOffsetX=r.offsetX,this.draggingSelectionOffsetY=r.offsetY,this.draggingSelectionContent=r.content)}},e.prototype.mousemove=function(t){this.x=t.offsetX,this.y=t.offsetY,this.canvasState.mousePressing&&(this.canvasState.mouseupX=t.offsetX,this.canvasState.mouseupY=t.offsetY),this.canvasState.isDraggingForMoving&&("template"===this.canvasState.selection.kind?this.draggingSelectionContent?(this.draggingSelectionContent.x=this.canvasState.mouseupMappedX-this.draggingSelectionOffsetX,this.draggingSelectionContent.y=this.canvasState.mouseupMappedY-this.draggingSelectionOffsetY):(this.canvasState.selection.template.x=this.canvasState.mouseupMappedX-this.draggingSelectionOffsetX,this.canvasState.selection.template.y=this.canvasState.mouseupMappedY-this.draggingSelectionOffsetY):"content"===this.canvasState.selection.kind&&(this.canvasState.selection.content.x=this.canvasState.mouseupMappedX-this.draggingSelectionOffsetX,this.canvasState.selection.content.y=this.canvasState.mouseupMappedY-this.draggingSelectionOffsetY))},e.prototype.mouseup=function(t){if(this.canvasState.mouseupX=t.offsetX,this.canvasState.mouseupY=t.offsetY,this.canvasState.isDraggingForMoving){var e=(this.canvasState.styleGuideTranslateX-this.canvasState.styleGuideWidth/2)*this.canvasState.styleGuideScale+this.canvasState.styleGuideWidth/2,n=(this.canvasState.styleGuideTranslateY-this.canvasState.styleGuideHeight/2)*this.canvasState.styleGuideScale+this.canvasState.styleGuideHeight/2;if(this.canvasState.isDraggingForMoving=!1,this.canvasState.styleGuideTranslateX=(e-this.canvasState.styleGuideWidth/2)/this.canvasState.styleGuideScale+this.canvasState.styleGuideWidth/2,this.canvasState.styleGuideTranslateY=(n-this.canvasState.styleGuideHeight/2)/this.canvasState.styleGuideScale+this.canvasState.styleGuideHeight/2,this.canvasState.mousePressing=!1,this.canvasState.moved)return}var i=this.canvasState.mouseupMappedX,s=this.canvasState.mouseupMappedY;if(this.canvasState.isDraggingForSelection){var r=function(t,e,n){var i,s,r={x:Math.min(e.x,n.x),y:Math.min(e.y,n.y),width:Math.abs(e.x-n.x),height:Math.abs(e.y-n.y)};try{for(var o=Object(a.h)(t.templates),c=o.next();!c.done;c=o.next()){var l=c.value;if(et([{x:l.x,y:l.y},{x:l.x+l.width,y:l.y+l.height}],r))return l}}catch(t){i={error:t}}finally{try{c&&!c.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}return null}(this.canvasState.styleGuide,{x:i,y:s},{x:this.canvasState.mousedownMappedX,y:this.canvasState.mousedownMappedY});this.canvasState.selection=r?{kind:"template",template:r}:{kind:"none"}}else{var o=function(t,e){var n,i;try{for(var s=Object(a.h)(t.templates),r=s.next();!r.done;r=s.next()){var o=r.value,c=ot(o,o,e,t);if(c)return Object(a.a)({kind:"content"},c)}}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}var l=rt(t,e);if(l)return{kind:"template",template:l};return null}(this.canvasState.styleGuide,{x:i,y:s});o?"content"===o.kind?this.canvasState.selection={kind:"content",content:o.content,template:o.template}:"template"===o.kind&&(this.canvasState.selection={kind:"template",template:o.template}):this.canvasState.selection={kind:"none"}}this.canvasState.mousePressing=!1},e.prototype.contextmenu=function(t){this.canvasState.contextMenuEnabled=!0,this.canvasState.contextMenuX=t.offsetX,this.canvasState.contextMenuY=t.offsetY,this.canvasState.mousePressing=!1,t.preventDefault()},e.prototype.keydown=function(t){if(t.ctrlKey||t.metaKey)if("c"===t.key)"none"!==this.canvasState.selection.kind&&(this.clipboard=this.canvasState.selection);else if("v"===t.key){if("template"===this.clipboard.kind)if(this.canvasState.action(),"template"===this.canvasState.selection.kind){if(this.clipboard.template!==this.canvasState.selection.template){var e={kind:"reference",id:this.clipboard.template.id,x:0,y:0};this.canvasState.selection.template.contents.push(e),this.canvasState.selection={kind:"content",content:e,template:this.canvasState.selection.template}}}else if("none"===this.canvasState.selection.kind){var n=JSON.parse(JSON.stringify(this.clipboard.template));n.id=Math.random().toString(),n.x=0,n.y=0,this.canvasState.styleGuide.templates.push(n),this.canvasState.selection={kind:"template",template:n}}}else"z"===t.key&&this.canvasState.undo()},e.prototype.getSelectionAreaRelation=function(t){var e,n,i,s,r,o,c,l;if("template"===this.canvasState.selection.kind)try{for(var p=Object(a.h)(Z(this.canvasState.selection.template,this.canvasState.styleGuide)),u=p.next();!u.done;u=p.next()){var h=u.value;if(et(t,{x:h.x,y:h.y,width:this.canvasState.selection.template.width,height:this.canvasState.selection.template.height}))return h.content?{offsetX:t.x-h.content.x,offsetY:t.y-h.content.y,content:h.content}:{offsetX:t.x-h.x,offsetY:t.y-h.y}}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}else if("content"===this.canvasState.selection.kind){var d=this.canvasState.selection.content;if("image"===d.kind||"text"===d.kind)try{for(var v=Object(a.h)(tt(d,this.canvasState.styleGuide)),f=v.next();!f.done;f=v.next()){if(et(t,{x:(b=f.value).x,y:b.y,width:d.width,height:d.height}))return{offsetX:t.x-d.x,offsetY:t.y-d.y,content:void 0}}}catch(t){i={error:t}}finally{try{f&&!f.done&&(s=v.return)&&s.call(v)}finally{if(i)throw i.error}}else if("reference"===d.kind){var y=this.canvasState.styleGuide.templates.find((function(t){return t.id===d.id}));if(y)try{for(var m=Object(a.h)(tt(d,this.canvasState.styleGuide)),g=m.next();!g.done;g=m.next()){if(et(t,{x:(b=g.value).x,y:b.y,width:y.width,height:y.height}))return{offsetX:t.x-d.x,offsetY:t.y-d.y,content:void 0}}}catch(t){r={error:t}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(r)throw r.error}}}else if("snapshot"===d.kind)try{for(var S=Object(a.h)(tt(d,this.canvasState.styleGuide)),x=S.next();!x.done;x=S.next()){var b;if(et(t,{x:(b=x.value).x,y:b.y,width:d.snapshot.width,height:d.snapshot.height}))return{offsetX:t.x-d.x,offsetY:t.y-d.y,content:void 0}}}catch(t){c={error:t}}finally{try{x&&!x.done&&(l=S.return)&&l.call(S)}finally{if(c)throw c.error}}}},e=Object(a.c)([Object(s.a)({render:v,staticRenderFns:f,props:{canvasState:F}})],e)}(i.a);function rt(t,e){var n,i;try{for(var s=Object(a.h)(t.templates),r=s.next();!r.done;r=s.next()){var o=r.value;if(et(e,o))return o}}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return null}function ot(t,e,n,i){var s,r,o=function(s){var r={x:s.x+e.x,y:s.y+e.y};if("image"===s.kind||"text"===s.kind){if(et(n,Object(a.a)(Object(a.a)({},r),{width:s.width,height:s.height})))return{value:{content:s,template:t}}}else if("reference"===s.kind){var o=i.templates.find((function(t){return t.id===s.id}));if(o){if(et(n,Object(a.a)(Object(a.a)({},r),{width:o.width,height:o.height})))return{value:{content:s,template:t}};if(c=ot(o,r,n,i))return{value:c}}}else if("snapshot"===s.kind){var c;if(c=ot(s.snapshot,r,n,i))return{value:c};if(et(n,Object(a.a)(Object(a.a)({},r),{width:s.snapshot.width,height:s.snapshot.height})))return{value:{content:s,template:t}}}};try{for(var c=Object(a.h)(t.contents),l=c.next();!l.done;l=c.next()){var p=o(l.value);if("object"==typeof p)return p.value}}catch(t){s={error:t}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(s)throw s.error}}return null}var ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"contextMenuStyle",{get:function(){return{position:"absolute",left:this.canvasState.contextMenuX+"px",top:this.canvasState.contextMenuY+"px",width:"100px",height:"200px",backgroundColor:"#eee"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maskStyle",{get:function(){return{position:"absolute",width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",opacity:0}},enumerable:!0,configurable:!0}),e.prototype.close=function(t){this.canvasState.contextMenuEnabled=!1,t.stopPropagation()},e.prototype.remove=function(){var t,e,n=this.canvasState.mapX(this.canvasState.contextMenuX),i=this.canvasState.mapY(this.canvasState.contextMenuY);if(this.canvasState.action(),"template"===this.canvasState.selection.kind)for(var s=0;s<this.canvasState.styleGuide.templates.length;s++){var r=this.canvasState.styleGuide.templates[s];if(et({x:n,y:i},r)){if(r===this.canvasState.selection.template)return void this.canvasState.styleGuide.templates.splice(s,1);for(var o=0;o<r.contents.length;o++){var c=r.contents[o];if("reference"===c.kind&&c.id===this.canvasState.selection.template.id&&et({x:n,y:i},{x:r.x+c.x,y:r.y+c.y,width:r.width,height:r.height}))return void r.contents.splice(o,1)}}}else if("content"===this.canvasState.selection.kind)try{for(var l=Object(a.h)(tt(this.canvasState.selection.content,this.canvasState.styleGuide,this.canvasState.selection.template)),p=l.next();!p.done;p=l.next()){var u=p.value;return void u.contents.splice(u.index,1)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}},e=Object(a.c)([Object(s.a)({render:p,staticRenderFns:u,props:{canvasState:F}})],e)}(i.a),lt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.imageUrl="",e}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"panelStyle",{get:function(){return{height:this.canvasState.canvasHeight+"px",overflow:"auto"}},enumerable:!0,configurable:!0}),e.prototype.changePosition=function(t,e){"content"===this.canvasState.selection.kind?this.canvasState.selection.content[e]=+t.target.value:"template"===this.canvasState.selection.kind&&(this.canvasState.selection.template[e]=+t.target.value)},e.prototype.changeSize=function(t,e){"content"!==this.canvasState.selection.kind||"image"!==this.canvasState.selection.content.kind&&"text"!==this.canvasState.selection.content.kind?"template"===this.canvasState.selection.kind&&(this.canvasState.selection.template[e]=+t.target.value):this.canvasState.selection.content[e]=+t.target.value},e.prototype.changePositionExpression=function(t,e){"content"===this.canvasState.selection.kind&&i.a.set(this.canvasState.selection.content,e+"Expression",t.target.value)},e.prototype.changeSizeExpression=function(t,e){"content"!==this.canvasState.selection.kind||"image"!==this.canvasState.selection.content.kind&&"text"!==this.canvasState.selection.content.kind?"template"===this.canvasState.selection.kind&&i.a.set(this.canvasState.selection.template,e+"Expression",t.target.value):i.a.set(this.canvasState.selection.content,e+"Expression",t.target.value)},e.prototype.changeHidden=function(t){"content"===this.canvasState.selection.kind&&i.a.set(this.canvasState.selection.content,"hidden",t.target.checked)},e.prototype.changeIf=function(t){"content"===this.canvasState.selection.kind&&"snapshot"!==this.canvasState.selection.content.kind&&i.a.set(this.canvasState.selection.content,"if",t.target.value)},e.prototype.changeRepeat=function(t){"content"===this.canvasState.selection.kind&&"snapshot"!==this.canvasState.selection.content.kind&&i.a.set(this.canvasState.selection.content,"repeat",t.target.value)},e.prototype.changeProps=function(t){"content"===this.canvasState.selection.kind&&"reference"===this.canvasState.selection.content.kind&&i.a.set(this.canvasState.selection.content,"props",t.target.value)},e.prototype.changeText=function(t){"content"===this.canvasState.selection.kind&&"text"===this.canvasState.selection.content.kind&&(this.canvasState.selection.content.text=t.target.value,this.canvasState.selection.content.characters=P(t.target.value))},e.prototype.changeTextExpression=function(t){"content"===this.canvasState.selection.kind&&"text"===this.canvasState.selection.content.kind&&i.a.set(this.canvasState.selection.content,"textExpression",t.target.value)},e.prototype.changeFontFamily=function(t){"content"===this.canvasState.selection.kind&&"text"===this.canvasState.selection.content.kind&&(this.canvasState.selection.content.fontFamily=t.target.value)},e.prototype.changeFontSize=function(t){"content"===this.canvasState.selection.kind&&"text"===this.canvasState.selection.content.kind&&(this.canvasState.selection.content.fontSize=+t.target.value)},e.prototype.changeFontSizeExpression=function(t){"content"===this.canvasState.selection.kind&&"text"===this.canvasState.selection.content.kind&&i.a.set(this.canvasState.selection.content,"fontSizeExpression",t.target.value)},e.prototype.changeColor=function(t){"content"===this.canvasState.selection.kind&&"text"===this.canvasState.selection.content.kind&&(this.canvasState.selection.content.color=t.target.value)},e.prototype.changeImageUrl=function(t){"content"===this.canvasState.selection.kind&&"image"===this.canvasState.selection.content.kind&&(this.canvasState.selection.content.url=t.target.value)},e.prototype.changeImageUrlExpression=function(t){"content"===this.canvasState.selection.kind&&"image"===this.canvasState.selection.content.kind&&i.a.set(this.canvasState.selection.content,"urlExpression",t.target.value)},e.prototype.debug=function(){"none"===this.canvasState.selection.kind?console.info(this.canvasState):console.info(this.canvasState.selection)},e.prototype.addTemplate=function(){this.canvasState.addKind="template"},e.prototype.addImage=function(){this.canvasState.addKind="image"},e.prototype.addText=function(){this.canvasState.addKind="text"},e.prototype.selectContent=function(t){"none"!==this.canvasState.selection.kind&&(this.canvasState.selection={kind:"content",content:t,template:this.canvasState.selection.template})},e.prototype.extractAsSymbol=function(){if("content"===this.canvasState.selection.kind&&("text"===this.canvasState.selection.content.kind||"image"===this.canvasState.selection.content.kind)){var t=Math.random().toString(),e=this.canvasState.selection.content,n={id:t,contents:[Object(a.a)(Object(a.a)({},e),{x:0,y:0})],x:0,y:0,width:e.width,height:e.height};this.canvasState.styleGuide.templates.push(n);var i=this.canvasState.selection.template.contents.findIndex((function(t){return t===e}));i>=0&&(this.canvasState.selection.template.contents[i]={kind:"reference",id:t,x:e.x,y:e.y}),this.canvasState.selection={kind:"template",template:n}}},e.prototype.renderToImage=function(){return Object(a.b)(this,void 0,void 0,(function(){var t,e;return Object(a.e)(this,(function(n){switch(n.label){case 0:return"template"!==this.canvasState.selection.kind?[3,2]:[4,$(this.canvasState.selection.template,this.canvasState.styleGuide.templates)];case 1:t=n.sent(),e=R(this.canvasState.selection.template,this.canvasState.styleGuide.templates,t),this.imageUrl=e,n.label=2;case 2:return[2]}}))}))},e=Object(a.c)([Object(s.a)({render:y,staticRenderFns:m,props:{canvasState:F}})],e)}(i.a),pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(e,t),Object.defineProperty(e.prototype,"canvasStyle",{get:function(){return{width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",position:"absolute"}},enumerable:!0,configurable:!0}),e=Object(a.c)([Object(s.a)({render:w,staticRenderFns:O,props:{canvasState:F}})],e)}(i.a);i.a.component("render-layer",B),i.a.component("dragging-for-selection-layer",Q),i.a.component("selection-layer",it),i.a.component("mask-layer",st),i.a.component("context-menu",ct),i.a.component("operation-panel",lt),n.d(e,"App",(function(){return ut})),i.a.component("app-panel",D),i.a.component("template-model-editor",I),i.a.component("template-editor",pt);var ut=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.appState=new N,e}return Object(a.d)(e,t),e.prototype.mounted=function(){var t=this;window.addEventListener("resize",(function(){t.appState.resize()}))},e=Object(a.c)([Object(s.a)({render:c,staticRenderFns:l})],e)}(i.a);new ut({el:"#container"})}});
</script>
