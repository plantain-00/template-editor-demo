<!DOCTYPE html>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="A template editor demo.">
<title>template-editor-demo</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:"Lucida Grande","Lucida Sans Unicode","Hiragino Sans GB","WenQuanYi Micro Hei","Verdana,Aril",sans-serif;-webkit-font-smoothing:antialiased}.schema-based-json-editor--card{padding:1.25rem;border:1px solid rgba(0,0,0,.125);border-radius:.25rem}button{margin:5px;padding:5px;border-radius:5px;cursor:pointer}input[type=number],input[type=text]{width:180px;padding:5px;margin:5px}select{height:29px;padding:5px;margin:5px}/*!
 * "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License
 * https://github.com/simonwhitaker/github-fork-ribbon-css
*/.github-fork-ribbon{width:12.1em;height:12.1em;position:absolute;overflow:hidden;top:0;right:0;z-index:9999;pointer-events:none;font-size:13px;text-decoration:none;text-indent:-999999px}.github-fork-ribbon.fixed{position:fixed}.github-fork-ribbon:active,.github-fork-ribbon:hover{background-color:rgba(0,0,0,0)}.github-fork-ribbon:after,.github-fork-ribbon:before{position:absolute;display:block;width:15.38em;height:1.54em;top:3.23em;right:-3.23em;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.github-fork-ribbon:before{content:"";padding:.38em 0;background-color:#a00;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,0)),to(rgba(0,0,0,.15)));background-image:-webkit-linear-gradient(top,rgba(0,0,0,0),rgba(0,0,0,.15));background-image:-moz-linear-gradient(top,rgba(0,0,0,0),rgba(0,0,0,.15));background-image:-ms-linear-gradient(top,rgba(0,0,0,0),rgba(0,0,0,.15));background-image:-o-linear-gradient(top,rgba(0,0,0,0),rgba(0,0,0,.15));background-image:linear-gradient(to bottom,rgba(0,0,0,0),rgba(0,0,0,.15));-webkit-box-shadow:0 .15em .23em 0 rgba(0,0,0,.5);-moz-box-shadow:0 .15em .23em 0 rgba(0,0,0,.5);box-shadow:0 .15em .23em 0 rgba(0,0,0,.5);pointer-events:auto}.github-fork-ribbon:after{content:attr(data-ribbon);color:#fff;font:700 1em "Helvetica Neue",Helvetica,Arial,sans-serif;line-height:1.54em;text-decoration:none;text-shadow:0 -.08em rgba(0,0,0,.5);text-align:center;text-indent:0;padding:.15em 0;margin:.15em 0;border-width:.08em 0;border-style:dotted;border-color:#fff;border-color:rgba(255,255,255,.7)}.github-fork-ribbon.left-bottom,.github-fork-ribbon.left-top{right:auto;left:0}.github-fork-ribbon.left-bottom,.github-fork-ribbon.right-bottom{top:auto;bottom:0}.github-fork-ribbon.left-bottom:after,.github-fork-ribbon.left-bottom:before,.github-fork-ribbon.left-top:after,.github-fork-ribbon.left-top:before{right:auto;left:-3.23em}.github-fork-ribbon.left-bottom:after,.github-fork-ribbon.left-bottom:before,.github-fork-ribbon.right-bottom:after,.github-fork-ribbon.right-bottom:before{top:auto;bottom:3.23em}.github-fork-ribbon.left-top:after,.github-fork-ribbon.left-top:before,.github-fork-ribbon.right-bottom:after,.github-fork-ribbon.right-bottom:before{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}
</style>
<a class="github-fork-ribbon right-top" data-ribbon="Fork me on GitHub" href="https://github.com/plantain-00/template-editor-demo" title="Fork me on GitHub" target="_blank" rel="noopener">Fork me on GitHub</a>
<div id="prerender-container">
<div id="container"></div>
</div>
<script src="vendor.bundle-55b981e0acf907c140853c3ebec32b76.js" crossOrigin="anonymous" integrity="sha256-LJQQi1LZbniZ5RMo89izEWKw4ig8hu5mxzozJIHriw0="></script>
<script>
!function(e){function t(t){for(var i,r,o=t[0],c=t[1],p=t[2],u=0,h=[];u<o.length;u++)r=o[u],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&h.push(a[r][0]),a[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(l&&l(t);h.length;)h.shift()();return s.push.apply(s,p||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(i=!1)}i&&(s.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},a={0:0},s=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var p=0;p<o.length;p++)t(o[p]);var l=c;s.push([60,1]),n()}({60:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n(1),s=n(2);n(21);function r(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex","align-items":"center",height:"50px"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.styleGuideKey,expression:"styleGuideKey"}],attrs:{type:"text"},domProps:{value:e.styleGuideKey},on:{input:function(t){t.target.composing||(e.styleGuideKey=t.target.value)}}}),e._v(" "),n("button",{on:{click:function(t){return e.loadStyleGuide()}}},[e._v("load style guide")]),e._v(" "),n("button",{on:{click:function(t){return e.saveStyleGuide()}}},[e._v("save style guide")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.templateModelKey,expression:"templateModelKey"}],attrs:{type:"text"},domProps:{value:e.templateModelKey},on:{input:function(t){t.target.composing||(e.templateModelKey=t.target.value)}}}),e._v(" "),n("button",{on:{click:function(t){return e.loadTemplateModel()}}},[e._v("load template model")]),e._v(" "),n("button",{on:{click:function(t){return e.saveTemplateModel()}}},[e._v("save template model")]),e._v(" "),n("button",{on:{click:function(t){return e.editTemplateModel()}}},[e._v(e._s(e.appState.templateModelEditorVisible?"hide template model editor":"show template model editor"))]),e._v(" "),n("button",{on:{click:function(t){return e.precompile()}}},[e._v("precompile")]),e._v(" "),n("button",{on:{click:function(t){return e.generate()}}},[e._v(e._s(e.appState.graphicCanvasState?"back to template":"generate graphic"))])])}var o=[];function c(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex","flex-direction":"column"}},[n("div",{staticStyle:{height:"50px"}},[n("app-panel",{attrs:{appState:e.appState}}),e._v(" "),n("template-model-editor",{attrs:{appState:e.appState}})],1),e._v(" "),e.appState.graphicCanvasState?n("template-editor",{attrs:{canvasState:e.appState.graphicCanvasState}}):e._e(),e._v(" "),n("template-editor",{directives:[{name:"show",rawName:"v-show",value:!e.appState.graphicCanvasState,expression:"!appState.graphicCanvasState"}],attrs:{canvasState:e.appState.canvasState}})],1)}var p=[];function l(){var e=this,t=e.$createElement,n=e._self._c||t;return e.canvasState.contextMenuEnabled?n("div",{on:{click:e.close}},[n("div",{style:e.maskStyle}),e._v(" "),n("div",{style:e.contextMenuStyle},[n("button",{on:{click:e.remove}},[e._v("remove")])])]):e._e()}var u=[];function h(){var e=this.$createElement,t=this._self._c||e;return this.canvasState.isDraggingForSelection?t("div",{style:this.draggingAreaStyle}):this._e()}var d=[];function v(){var e=this.$createElement;return(this._self._c||e)("div",{style:this.maskStyle,attrs:{tabindex:"0"},on:{wheel:this.wheel,mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,contextmenu:this.contextmenu,keydown:this.keydown}})}var y=[];function f(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{style:e.panelStyle},["content"===e.canvasState.selection.kind?n("div",["text"===e.canvasState.selection.content.kind?n("div",[e._v("\n      text\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.text,literalType:"text",expression:e.canvasState.selection.content.textExpression,expressionId:e.canvasState.selection.content.textExpressionId},on:{change:e.changeTextExpression}}),e._v(" "),n("br"),e._v("\n      font family\n      "),n("input",{attrs:{type:"text"},domProps:{value:e.canvasState.selection.content.fontFamily},on:{change:e.changeFontFamily}}),e._v(" "),n("br"),e._v("\n      font size\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.fontSize,literalType:"number",expression:e.canvasState.selection.content.fontSizeExpression,expressionId:e.canvasState.selection.content.fontSizeExpressionId},on:{change:e.changeFontSizeExpression}}),e._v(" "),n("br"),e._v("\n      color\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.color,literalType:"color",expression:e.canvasState.selection.content.colorExpression,expressionId:e.canvasState.selection.content.colorExpressionId},on:{change:e.changeColorExpression}})],1):e._e(),e._v(" "),"image"===e.canvasState.selection.content.kind?n("div",[e._v("\n      url\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.url,literalType:"text",expression:e.canvasState.selection.content.urlExpression,expressionId:e.canvasState.selection.content.urlExpressionId},on:{change:e.changeImageUrlExpression}}),e._v(" "),n("div",[e._v("\n        opacity\n        "),n("input",{attrs:{type:"number"},domProps:{value:e.canvasState.selection.content.opacity},on:{change:e.changeOpacity}})])],1):e._e(),e._v(" "),"color"===e.canvasState.selection.content.kind?n("div",[e._v("\n      color\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.color,literalType:"color",expression:e.canvasState.selection.content.colorExpression,expressionId:e.canvasState.selection.content.colorExpressionId},on:{change:e.changeColorExpression}})],1):e._e(),e._v(" "),n("div",[e._v("\n      x\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.x,literalType:"number",expression:e.canvasState.selection.content.xExpression,expressionId:e.canvasState.selection.content.xExpressionId},on:{change:function(t){return e.changePositionExpression(t,"x")}}})],1),e._v(" "),n("div",[e._v("\n      y\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.y,literalType:"number",expression:e.canvasState.selection.content.yExpression,expressionId:e.canvasState.selection.content.yExpressionId},on:{change:function(t){return e.changePositionExpression(t,"y")}}})],1),e._v(" "),n("div",[e._v("\n      z\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.z,literalType:"number",expression:e.canvasState.selection.content.zExpression,expressionId:e.canvasState.selection.content.zExpressionId},on:{change:function(t){return e.changePositionExpression(t,"z")}}})],1),e._v(" "),"text"===e.canvasState.selection.content.kind||"image"===e.canvasState.selection.content.kind||"color"===e.canvasState.selection.content.kind?n("div",[n("div",[e._v("\n        width\n        "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.width,literalType:"number",expression:e.canvasState.selection.content.widthExpression,expressionId:e.canvasState.selection.content.widthExpressionId},on:{change:function(t){return e.changeSizeExpression(t,"width")}}})],1),e._v(" "),n("div",[e._v("\n        height\n        "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.content.height,literalType:"number",expression:e.canvasState.selection.content.heightExpression,expressionId:e.canvasState.selection.content.heihtExpressionId},on:{change:function(t){return e.changeSizeExpression(t,"height")}}})],1)]):e._e(),e._v(" "),"snapshot"===e.canvasState.selection.content.kind?e._l(e.canvasState.selection.content.snapshot.contents,(function(t,i){return n("div",[n("div",{staticStyle:{cursor:"pointer"},on:{click:function(n){return e.selectContent(t)}}},[e._v("content "+e._s(i)+": "+e._s(t.kind))])])})):e._e(),e._v(" "),n("div",[e._v("\n      hidden\n      "),n("input",{attrs:{type:"checkbox"},domProps:{checked:e.canvasState.selection.content.hidden},on:{change:e.changeHidden}})]),e._v(" "),n("div",[e._v("\n      if\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,expression:e.canvasState.selection.content.if,expressionId:e.canvasState.selection.content.ifId},on:{change:e.changeIf}})],1),e._v(" "),n("div",[e._v("\n      repeat\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,expression:e.repeat.expression,expressionId:e.canvasState.selection.content.repeatId},on:{change:e.changeRepeatExpression}}),e._v(" "),n("input",{staticStyle:{width:"150px","margin-left":"25px"},attrs:{type:"text",placeholder:"item name"},domProps:{value:e.repeat.itemName},on:{change:e.changeRepeatItemName}}),e._v(" "),n("input",{staticStyle:{width:"50px"},attrs:{type:"text",placeholder:"index name"},domProps:{value:e.repeat.indexName},on:{change:e.changeRepeatIndexName}})],1),e._v(" "),"reference"===e.canvasState.selection.content.kind?n("div",[e._v("\n      props\n      "),n("span",{staticStyle:{opacity:"0.5"}},[e._v(e._s(e.canvasState.selection.content.props))]),e._v(" "),e.parameters?n("div",{staticStyle:{"margin-left":"10px"}},e._l(e.parameters,(function(t){return n("div",[e._v("\n          "+e._s(t)+"\n          "),n("expression-input",{attrs:{canvasState:e.canvasState,expression:e.getParameterValue(t),expressionId:e.getParameterExpressionId(t)},on:{change:function(n){return e.changeParameterValue(n,t)}}})],1)})),0):e._e()]):e._e(),e._v(" "),"text"===e.canvasState.selection.content.kind||"image"===e.canvasState.selection.content.kind||"color"===e.canvasState.selection.content.kind?n("div",[n("button",{on:{click:function(t){return e.extractAsComponent()}}},[e._v("extract as component")])]):e._e()],2):e._e(),e._v(" "),"template"===e.canvasState.selection.kind?n("div",[n("div",[e._v("\n      name\n      "),n("input",{attrs:{type:"text"},domProps:{value:e.canvasState.selection.template.name},on:{change:e.changeName}})]),e._v(" "),n("div",[e._v("\n      x\n      "),n("input",{attrs:{type:"number"},domProps:{value:e.canvasState.selection.template.x},on:{change:function(t){return e.changePosition(t,"x")}}})]),e._v(" "),n("div",[e._v("\n      y\n      "),n("input",{attrs:{type:"number"},domProps:{value:e.canvasState.selection.template.y},on:{change:function(t){return e.changePosition(t,"y")}}})]),e._v(" "),n("div",[e._v("\n      z\n      "),n("input",{attrs:{type:"number"},domProps:{value:e.canvasState.selection.template.z},on:{change:function(t){return e.changePosition(t,"z")}}})]),e._v(" "),n("div",[e._v("\n      width\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.template.width,literalType:"number",expression:e.canvasState.selection.template.widthExpression,expressionId:e.canvasState.selection.template.widthExpressionId},on:{change:function(t){return e.changeSizeExpression(t,"width")}}})],1),e._v(" "),n("div",[e._v("\n      height\n      "),n("expression-input",{attrs:{canvasState:e.canvasState,literal:e.canvasState.selection.template.height,literalType:"number",expression:e.canvasState.selection.template.heightExpression,expressionId:e.canvasState.selection.template.heightExpressionId},on:{change:function(t){return e.changeSizeExpression(t,"height")}}})],1),e._v(" "),e._l(e.canvasState.selection.template.contents,(function(t,i){return n("div",[n("div",{staticStyle:{cursor:"pointer"},on:{click:function(n){return e.selectContent(t)}}},[e._v("content "+e._s(i)+": "+e._s(t.kind))])])})),e._v(" "),n("div",[e._v("\n      display\n      "),n("select",{domProps:{value:e.canvasState.selection.template.display},on:{change:function(t){return e.changeFlex("display",t.target.value)}}},[n("option",{domProps:{value:void 0}}),e._v(" "),n("option",{attrs:{value:"flex"}},[e._v("flex")])])]),e._v(" "),n("div",[e._v("\n      flex direction\n      "),n("select",{domProps:{value:e.canvasState.selection.template.flexDirection},on:{change:function(t){return e.changeFlex("flexDirection",t.target.value)}}},[n("option",{attrs:{value:"row"}},[e._v("row")]),e._v(" "),n("option",{attrs:{value:"column"}},[e._v("column")])])]),e._v(" "),n("div",[e._v("\n      justify content\n      "),n("select",{domProps:{value:e.canvasState.selection.template.justifyContent},on:{change:function(t){return e.changeFlex("justifyContent",t.target.value)}}},[n("option",{attrs:{value:"start"}},[e._v("start")]),e._v(" "),n("option",{attrs:{value:"end"}},[e._v("end")]),e._v(" "),n("option",{attrs:{value:"center"}},[e._v("center")]),e._v(" "),n("option",{attrs:{value:"between"}},[e._v("between")])])]),e._v(" "),n("div",[e._v("\n      align items\n      "),n("select",{domProps:{value:e.canvasState.selection.template.alignItems},on:{change:function(t){return e.changeFlex("alignItems",t.target.value)}}},[n("option",{attrs:{value:"start"}},[e._v("start")]),e._v(" "),n("option",{attrs:{value:"end"}},[e._v("end")]),e._v(" "),n("option",{attrs:{value:"center"}},[e._v("center")])])]),e._v(" "),n("div",[n("button",{on:{click:function(t){return e.renderToImage()}}},[e._v("render to image")]),e._v(" "),e.imageUrl?n("img",{staticStyle:{"object-fit":"contain",width:"100%"},attrs:{src:e.imageUrl}}):e._e()]),e._v(" "),n("div",[e._l(e.canvasState.selection.template.parameters||[],(function(t,i){return n("div",[e._v("\n        parameter "+e._s(i)+"\n        "),n("input",{attrs:{type:"text"},domProps:{value:t},on:{change:function(t){return e.changeParameter(t,i)}}})])})),e._v(" "),n("button",{on:{click:function(t){return e.addParameter()}}},[e._v("add parameter")])],2)],2):e._e(),e._v(" "),n("div",[n("button",{on:{click:function(t){return e.debug()}}},[e._v("debug")])]),e._v(" "),n("div",[n("button",{on:{click:function(t){return e.addTemplate()}}},[e._v("add template")]),e._v(" "),n("button",{on:{click:function(t){return e.addText()}}},[e._v("add text")]),e._v(" "),n("button",{on:{click:function(t){return e.addImage()}}},[e._v("add image")]),e._v(" "),n("button",{on:{click:function(t){return e.addColor()}}},[e._v("add color")])])])}var m=[];function g(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{style:e.canvasStyle},[n("div",{style:e.styleGuideStyle},[e._l(e.canvasState.styleGuide.templates,(function(t){return[n("div",{style:e.getTemplateStyle(t)},[t.name?n("div",{style:e.getNameStyle(t)},[e._v(e._s(t.name))]):e._e(),e._v(" "),n("template-renderer",{attrs:{template:t,templates:e.canvasState.styleGuide.templates}})],1)]}))],2)])}var x=[];function S(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{style:e.canvasStyle},[n("div",{style:e.styleGuideStyle},[e._l(e.selectionRegions,(function(t){return[n("div",{style:e.getSelectionAreaStyle(t)})]}))],2)])}var b=[];function w(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex"}},[n("div",{style:e.canvasStyle},[n("render-layer",{attrs:{canvasState:e.canvasState}}),e._v(" "),n("selection-layer",{attrs:{canvasState:e.canvasState}}),e._v(" "),n("dragging-for-selection-layer",{attrs:{canvasState:e.canvasState}}),e._v(" "),n("mask-layer",{attrs:{canvasState:e.canvasState}}),e._v(" "),n("context-menu",{attrs:{canvasState:e.canvasState}})],1),e._v(" "),n("div",{staticStyle:{width:"300px",right:"0",position:"absolute"}},[n("operation-panel",{attrs:{canvasState:e.canvasState}})],1)])}var j=[];function O(){var e=this,t=e.$createElement,n=e._self._c||t;return e.appState.templateModelEditorVisible?n("div",{style:e.editorStyle},[n("json-editor",{attrs:{schema:e.schema,"initial-value":e.appState.templateModel},on:{"update-value":function(t){return e.updateValue(t)}}})],1):e._e()}var k=[],E=n(23),_=n.n(E);function I(e,t){var n,a;if("flex"===e.display)for(var s=e.flexDirection||"row",r=e.justifyContent||"start",o=e.alignItems||"start",c="row"===s?"x":"y",p="row"===s?"width":"height",l="row"===s?"y":"x",u=e.contents.reduce((function(e,n){return e+P(n,t)[p]}),0),h=0;h<e.contents.length;h++){(f=e.contents[h])[c]=z(r,e,p,u,h,t),f[l]=G(o,e,s,P(f,t))}var d=function(e){if("reference"===e.kind){var n=t.find((function(t){return t.id===e.id}));n&&I(n,t)}else"snapshot"===e.kind&&I(e.snapshot,t)};try{for(var v=Object(i.h)(e.contents),y=v.next();!y.done;y=v.next()){var f;d(f=y.value)}}catch(e){n={error:e}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(n)throw n.error}}}function z(e,t,n,i,a,s){var r;r="start"===e?0:"end"===e?t[n]-i:"center"===e?(t[n]-i)/2:t.contents.length>1?a*Math.max(0,(t[n]-i)/(t.contents.length-1)):0;for(var o=0;o<a;o++)r+=P(t.contents[o],s)[n];return r}function G(e,t,n,i){if("start"===e)return 0;var a="row"===n?"height":"width";return"end"===e?t[a]-i[a]:(t[a]-i[a])/2}function P(e,t){if("reference"===e.kind){var n=t.find((function(t){return t.id===e.id}));return n||{width:0,height:0}}return"snapshot"===e.kind?e.snapshot:e}var M=n(3);function T(e,t,n){try{if(n&&n.precompiledStyleGuide){var i=n.precompiledStyleGuide.ast[e];if(i instanceof Error)throw i;return Object(M.a)(i,t)}return Object(M.a)(Object(M.c)(Object(M.g)(e)),t)}catch(i){return void(n&&n.errorHandler&&n.errorHandler({error:i,expression:e,model:t,stack:n.stack}))}}function C(e,t,n,i){var a=e+"Expression",s=t[a];if(s){var r=T(s,n,R(i,a));if("number"==typeof r&&!isNaN(r))return r}return t[e]}function Y(e,t,n,i){var a=e+"Expression",s=t[a];if(s){var r=T(s,n,R(i,a));if("number"==typeof r&&!isNaN(r))return"z"===e?Math.round(r):r}return t[e]||0}function X(e,t,n){if(e.urlExpression){var i=T(e.urlExpression,t,R(n,"urlExpression"));if("string"==typeof i)return i}return e.url}function N(e,t,n){if(e.textExpression){var i=T(e.textExpression,t,R(n,"textExpression"));if("string"==typeof i)return i}return e.text}function F(e,t,n){if(e.fontSizeExpression){var i=T(e.fontSizeExpression,t,R(n,"fontSizeExpression"));if("number"==typeof i&&!isNaN(i))return i}return e.fontSize}function H(e,t,n){if(e.colorExpression){var i=T(e.colorExpression,t,R(n,"colorExpression"));if("string"==typeof i)return i}return e.color}function R(e,t){return e&&e.stack?Object(i.a)(Object(i.a)({},e),{stack:Object(i.g)(e.stack,[t])}):e}function W(e,t){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var i=n.getContext("2d");if(i){i.drawImage(e,0,0);for(var a=i.getImageData(0,0,e.width,e.height),s=0;s<e.width/2;s++)for(var r=0;r<e.height;r++){var o=4*(r*e.width+s)+3,c=Math.round(a.data[o]*t);c=Math.max(c,0),c=Math.min(c,255),a.data[o]=c}return i.putImageData(a,0,0),n}}function K(e){return new Promise((function(t){var n=document.createElement("img");n.crossOrigin="anonymous",n.onload=function(){t(n)},e.startsWith("data:image/")?n.src=e:n.src=e+"?random="+Math.random()}))}function D(e){return Array.from(e).map((function(e){return{text:e}}))}function A(e,t,n,a){return Object(i.b)(this,void 0,void 0,(function(){var s,r;return Object(i.e)(this,(function(o){switch(o.label){case 0:return[4,Promise.all(e.contents.map((function(e,s){return function e(t,n,a,s){return Object(i.b)(this,void 0,void 0,(function(){var r,o,c,p,l,u,h,d,v,y,f,m,g,x,S,b;return Object(i.e)(this,(function(w){switch(w.label){case 0:if("snapshot"===t.kind)return[2,[t]];if(!t.repeat)return[3,5];if(r=$(t.repeat,s),o=r.expression,c=r.itemName,p=r.indexName,g=T(o,a,R(s,"repeat")),!Array.isArray(g))return[3,5];l=[],u=0,w.label=1;case 1:return u<g.length?(h=Object(i.a)({},a),c&&(h[c]=g[u],p&&(h[p]=u)),v=(d=l.push).apply,y=[l],[4,e(Object(i.a)(Object(i.a)({},t),{repeat:void 0}),n,h,s)]):[3,4];case 2:v.apply(d,y.concat([i.g.apply(void 0,[w.sent()])])),w.label=3;case 3:return u++,[3,1];case 4:return[2,l];case 5:return t.if&&!1===(g=T(t.if,a,R(s,"if")))?[2,[]]:((t=Object(i.a)({},t)).x=Y("x",t,a,s),delete t.xExpression,t.y=Y("y",t,a,s),delete t.yExpression,"reference"!==t.kind?[3,8]:(f=t.id,(m=n.templates.find((function(e){return e.id===f})))?(t.props&&(g=T(t.props,a,R(s,"props")),delete t.props,a=Object(i.a)(Object(i.a)({},a),{props:g})),x={kind:"snapshot",x:t.x,y:t.y},[4,A(m,n,a,R(s,m.name||m.id))]):[3,7]));case 6:return[2,[(x.snapshot=w.sent(),x)]];case 7:return[2,[]];case 8:return t.width=C("width",t,a,s),delete t.widthExpression,t.height=C("height",t,a,s),delete t.heightExpression,"text"===t.kind&&(t.text=N(t,a,s),delete t.textExpression,t.characters=D(t.text),t.fontSize=F(t,a,s),delete t.fontSizeExpression,t.color=H(t,a,s),delete t.colorExpression),"image"!==t.kind?[3,10]:(t.url=X(t,a,s),delete t.urlExpression,void 0===t.opacity?[3,10]:[4,K(t.url)]);case 9:S=w.sent(),(b=W(S,t.opacity))&&(t.base64=b.toDataURL()),w.label=10;case 10:return"color"===t.kind&&(t.color=H(t,a,s),delete t.colorExpression),[2,[t]]}}))}))}(e,t,n,R(a,s))})))];case 1:return s=o.sent(),(r=Object(i.a)(Object(i.a)({},e),{x:0,y:0,contents:s.reduce((function(e,t){return e.concat(t)}),[])})).width=C("width",r,n,a),delete r.widthExpression,r.height=C("height",r,n,a),delete r.heightExpression,I(r,t.templates),[2,r]}}))}))}var V=function(){function e(e){var t,n,a,s;this.ast={},this.repeat={};try{for(var r=Object(i.h)(e.templates),o=r.next();!o.done;o=r.next()){var c=o.value;this.collectExpression(c.widthExpression),this.collectExpression(c.heightExpression);try{for(var p=(a=void 0,Object(i.h)(c.contents)),l=p.next();!l.done;l=p.next()){var u=l.value;if("snapshot"!==u.kind){if(u.repeat){var h=this.collectRepeat(u.repeat);this.collectExpression(h.expression)}this.collectExpression(u.if),this.collectExpression(u.xExpression),this.collectExpression(u.yExpression),"reference"!==u.kind?(this.collectExpression(u.widthExpression),this.collectExpression(u.heightExpression),"text"===u.kind?(this.collectExpression(u.textExpression),this.collectExpression(u.fontSizeExpression),this.collectExpression(u.colorExpression)):"image"===u.kind?this.collectExpression(u.urlExpression):"color"===u.kind&&this.collectExpression(u.colorExpression)):this.collectExpression(u.props)}}}catch(e){a={error:e}}finally{try{l&&!l.done&&(s=p.return)&&s.call(p)}finally{if(a)throw a.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}return e.prototype.collectExpression=function(e){e&&!this.ast[e]&&(this.ast[e]=function(e){try{return Object(M.c)(Object(M.g)(e))}catch(e){return e}}(e))},e.prototype.collectRepeat=function(e){return this.repeat[e]||(this.repeat[e]=$(e)),this.repeat[e]},e}();function $(e,t){if(t&&t.precompiledStyleGuide)return t.precompiledStyleGuide.repeat[e];var n=e.indexOf(" in ");if(-1===n)return{expression:e};var i=e.substring(0,n).trim(),a=e.substring(n+4).trim();if(i.startsWith("(")&&i.endsWith(")")){var s=i.substring(1,i.length-1).split(",");return 0===s.length?{expression:a}:1===s.length?{expression:a,itemName:s[0].trim()}:{expression:a,itemName:s[0].trim(),indexName:s[1].trim()}}return{expression:a,itemName:i}}function L(e){if(e.expression)return e.itemName?e.indexName?"("+e.itemName+", "+e.indexName+") in "+e.expression:e.itemName+" in "+e.expression:e.expression}var q={name:"test",templates:[{id:"1",name:"组件",x:0,y:0,width:500,height:300,contents:[{kind:"text",text:"test",fontFamily:"serif",fontSize:50,color:"#FF0000",width:100,height:100,x:10,y:10},{kind:"image",url:"https://mdn.mozillademos.org/files/6457/mdn_logo_only_color.png",width:100,height:100,x:210,y:10,xExpression:"props.width - 300"}],parameters:["width"],widthExpression:"props.width"},{id:"2",name:"模板",x:600,y:0,width:1100,height:400,contents:[{kind:"reference",id:"1",x:10,y:10,props:"{width: 400}"},{kind:"reference",id:"1",x:550,y:10}]}]};function U(e,t){var n,a,s,r,o,c;return Object(i.e)(this,(function(p){switch(p.label){case 0:p.trys.push([0,5,6,7]),n=Object(i.h)(t.templates),a=n.next(),p.label=1;case 1:return a.done?[3,4]:(s=a.value,[5,Object(i.h)(Q(e,s,{x:s.x,y:s.y,z:s.z||0},t,void 0))]);case 2:p.sent(),p.label=3;case 3:return a=n.next(),[3,1];case 4:return[3,7];case 5:return r=p.sent(),o={error:r},[3,7];case 6:try{a&&!a.done&&(c=n.return)&&c.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}}))}function J(e,t,n){var a,s,r,o,c,p;return Object(i.e)(this,(function(l){switch(l.label){case 0:return n?[5,Object(i.h)(Z(e,n,{x:n.x,y:n.y,z:n.z||0},t,void 0))]:[3,2];case 1:return l.sent(),[2];case 2:l.trys.push([2,7,8,9]),a=Object(i.h)(t.templates),s=a.next(),l.label=3;case 3:return s.done?[3,6]:(r=s.value,[5,Object(i.h)(Z(e,r,{x:r.x,y:r.y,z:r.z||0},t,void 0))]);case 4:l.sent(),l.label=5;case 5:return s=a.next(),[3,3];case 6:return[3,9];case 7:return o=l.sent(),c={error:o},[3,9];case 8:try{s&&!s.done&&(p=a.return)&&p.call(a)}finally{if(c)throw c.error}return[7];case 9:return[2]}}))}function B(e,t){return Array.isArray(e)?e.every((function(e){return B(e,t)})):e.x>=t.x&&e.y>=t.y&&e.x<=t.x+t.width&&e.y<=t.y+t.height}function Q(e,t,n,a,s,r){var o,c,p,l;return Object(i.e)(this,(function(u){switch(u.label){case 0:return t!==e&&void 0!==e?[3,2]:(o=s?C("width",t,{props:s}):t.width,c=s?C("height",t,{props:s}):t.height,[4,{x:n.x,y:n.y,z:n.z,width:o,height:c,parent:r,template:t}]);case 1:u.sent(),u.label=2;case 2:if(!e||t===e)return[3,6];p=function(r){var o,c,p,l,u,h;return Object(i.e)(this,(function(d){switch(d.label){case 0:return"reference"!==(o=t.contents[r]).kind?[3,2]:(c=a.templates.find((function(e){return e.id===o.id})))?(p=ee(s,"x",o,t,a.templates),l=ee(s,"y",o,t,a.templates),u=ee(s,"z",o,t,a.templates),h=o.props?T(o.props,{props:s}):void 0,[5,Object(i.h)(Q(e,c,{x:p+n.x,y:l+n.y,z:u+n.z},a,h,{content:o,template:t,index:r}))]):[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}}))},l=0,u.label=3;case 3:return l<t.contents.length?[5,p(l)]:[3,6];case 4:u.sent(),u.label=5;case 5:return l++,[3,3];case 6:return[2]}}))}function Z(e,t,n,a,s){var r,o,c,p,l,u,h,d,v;return Object(i.e)(this,(function(i){switch(i.label){case 0:r=0,i.label=1;case 1:return r<t.contents.length?(o=t.contents[r])!==e&&void 0!==e?[3,3]:(c=ee(s,"x",o,t,a.templates),p=ee(s,"y",o,t,a.templates),l=ee(s,"z",o,t,a.templates),u="reference"===o.kind&&o.props?T(o.props,{props:s}):void 0,h=P(o,a.templates),d=u?C("width",h,{props:u}):h.width,v=u?C("height",h,{props:u}):h.height,[4,{x:n.x+c,y:n.y+p,z:n.z+l,width:d,height:v,index:r,contents:t.contents,content:o,template:t}]):[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}function ee(e,t,n,i,a){return"z"!==t&&i&&"flex"===i.display?function(e,t,n,i){var a=n.flexDirection||"row";if(t===("row"===a?"x":"y")){var s="row"===a?"width":"height";return z(n.justifyContent||"start",n,s,n.contents.reduce((function(e,t){return e+P(t,i)[s]}),0),n.contents.findIndex((function(t){return t===e})),i)}return G(n.alignItems||"start",n,a,P(e,i))}(n,t,i,a):e?Y(t,n,{props:e}):n[t]||0}function te(e,t){var n,a,s,r,o,c;return Object(i.e)(this,(function(p){switch(p.label){case 0:p.trys.push([0,5,6,7]),n=Object(i.h)(t.templates),a=n.next(),p.label=1;case 1:return a.done?[3,4]:(s=a.value,void 0!==e&&e!==s||!s.name?[3,3]:[4,{x:s.x,y:s.y-ne,z:s.z||0,width:ne*s.name.length,height:ne,template:s,parent:void 0}]);case 2:p.sent(),p.label=3;case 3:return a=n.next(),[3,1];case 4:return[3,7];case 5:return r=p.sent(),o={error:r},[3,7];case 6:try{a&&!a.done&&(c=n.return)&&c.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}}))}var ne=25,ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.styleGuide={name:"",templates:[]},t.styleGuideTranslateX=0,t.styleGuideTranslateY=0,t.styleGuideScale=1,t.canvasWidth=1200,t.canvasHeight=400,t.selection={kind:"none"},t.mousedownX=0,t.mousedownY=0,t.mouseupX=0,t.mouseupY=0,t.mousePressing=!1,t.isDraggingForMoving=!1,t.contextMenuEnabled=!1,t.contextMenuX=0,t.contextMenuY=0,t._styleGuideWidth=0,t._styleGuideHeight=0,t.styleGuideHistory=[],t.presetExpressions=[{id:"1",name:"price count",expression:"commodity.prices.length == 3",variables:[{tokenIndex:6},"prices"]},{id:"2",name:"commodity property",expression:"commodity.name",variables:["commodity",{tokenIndex:2,enum:["name","id","description","image"]}]},{id:"3",name:"price index",expression:"commodity?.prices?.[0]",variables:["the",{tokenIndex:5},"th price"]},{id:"4",name:"component parameter",expression:"props.name",variables:["component parameter",{tokenIndex:2,internal:"component parameters"}]},{id:"5",name:"categories range",expression:"categories.slice(0, 1)",variables:["categories",{tokenIndex:4},"until",{tokenIndex:6}]}],t}var n;return Object(i.d)(t,e),n=t,t.create=function(e,t,i){var a=new n;return a.styleGuide=e,a.canvasWidth=t,a.canvasHeight=i,a.applyCanvasSizeChange(),a},t.prototype.applyCanvasSizeChange=function(){var e=this.canvasWidth/this.styleGuideWidth,t=this.canvasHeight/this.styleGuideHeight;this.styleGuideScale=.9*Math.min(e,t);var n=this.styleGuideWidth*(e-this.styleGuideScale)/2,i=this.styleGuideHeight*(t-this.styleGuideScale)/2;this.styleGuideTranslateX=(n-this.styleGuideX*this.styleGuideScale-this.styleGuideWidth/2)/this.styleGuideScale+this.styleGuideWidth/2,this.styleGuideTranslateY=(i-this.styleGuideY*this.styleGuideScale-this.styleGuideHeight/2)/this.styleGuideScale+this.styleGuideHeight/2},Object.defineProperty(t.prototype,"styleGuideX",{get:function(){return Math.min.apply(Math,Object(i.g)(this.styleGuide.templates.map((function(e){return e.x}))))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"styleGuideWidth",{get:function(){if(this.isDraggingForMoving)return this._styleGuideWidth;var e=Math.max.apply(Math,Object(i.g)(this.styleGuide.templates.map((function(e){return e.x+e.width})))),t=Math.max(e-this.styleGuideX,10);return this._styleGuideWidth=t,t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"styleGuideY",{get:function(){return Math.min.apply(Math,Object(i.g)(this.styleGuide.templates.map((function(e){return e.y}))))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"styleGuideHeight",{get:function(){if(this.isDraggingForMoving)return this._styleGuideHeight;var e=Math.max.apply(Math,Object(i.g)(this.styleGuide.templates.map((function(e){return e.y+e.height})))),t=Math.max(e-this.styleGuideY,10);return this._styleGuideHeight=t,t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDraggingForSelection",{get:function(){return this.moved&&this.mousePressing&&!this.isDraggingForMoving},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"moved",{get:function(){return!ae(this.mouseupX,this.mousedownX)||!ae(this.mouseupY,this.mousedownY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mousedownMappedX",{get:function(){return this.mapX(this.mousedownX)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mousedownMappedY",{get:function(){return this.mapY(this.mousedownY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mouseupMappedX",{get:function(){return this.mapX(this.mouseupX)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mouseupMappedY",{get:function(){return this.mapY(this.mouseupY)},enumerable:!0,configurable:!0}),t.prototype.mapX=function(e){return(e-((this.styleGuideTranslateX-this.styleGuideWidth/2)*this.styleGuideScale+this.styleGuideWidth/2))/this.styleGuideScale},t.prototype.mapY=function(e){return(e-((this.styleGuideTranslateY-this.styleGuideHeight/2)*this.styleGuideScale+this.styleGuideHeight/2))/this.styleGuideScale},t.prototype.action=function(){this.styleGuideHistory.push(JSON.parse(JSON.stringify(this.styleGuide))),this.styleGuideHistory.length>10&&this.styleGuideHistory.splice(0,this.styleGuideHistory.length-10)},t.prototype.undo=function(){var e=this.styleGuideHistory.pop();e&&(this.styleGuide=e)},Object.defineProperty(t.prototype,"allTemplateRegions",{get:function(){return"template"===this.selection.kind?Array.from(U(this.selection.template,this.styleGuide)):[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allContentRegions",{get:function(){return"content"===this.selection.kind?Array.from(J(this.selection.content,this.styleGuide,this.selection.template)):[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allNameRegions",{get:function(){return"template"===this.selection.kind?Array.from(te(this.selection.template,this.styleGuide)):[]},enumerable:!0,configurable:!0}),t=n=Object(i.c)([s.a],t)}(a.a);function ae(e,t){var n=e-t;return n<Number.EPSILON&&n>-Number.EPSILON}var se=300,re=50,oe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.templateModel={categories:[]},t.templateModelEditorVisible=!1,t.canvasState=ie.create(q,window.innerWidth-se,window.innerHeight-re),t.graphicCanvasState=null,t}return Object(i.d)(t,e),t.prototype.resize=function(){this.canvasState.canvasWidth=window.innerWidth-se,this.canvasState.canvasHeight=window.innerHeight-re,this.canvasState.applyCanvasSizeChange(),this.graphicCanvasState&&(this.graphicCanvasState.canvasWidth=window.innerWidth-se,this.graphicCanvasState.canvasHeight=window.innerHeight-re,this.graphicCanvasState.applyCanvasSizeChange())},t.prototype.loadGraphicCanvas=function(e){this.graphicCanvasState=ie.create({name:"",templates:[e]},window.innerWidth-se,window.innerHeight-re),this.graphicCanvasState.selection={kind:"template",template:e}},t=Object(i.c)([s.a],t)}(a.a),ce=(new _.a).compile({$ref:"#/definitions/StyleGuide",definitions:{StyleGuide:{type:"object",properties:{name:{type:"string"},templates:{type:"array",items:{$ref:"#/definitions/Template"}}},required:["name","templates"],additionalProperties:!1},Template:{type:"object",properties:{id:{type:"string"},name:{type:"string"},contents:{type:"array",items:{$ref:"#/definitions/TemplateContent"}},parameters:{type:"array",items:{type:"string"}},x:{type:"number"},y:{type:"number"},z:{type:"integer"},width:{type:"number"},height:{type:"number"},widthExpression:{type:"string"},heightExpression:{type:"string"},widthExpressionId:{type:"string"},heightExpressionId:{type:"string"},display:{type:"string",const:"flex"},flexDirection:{type:"string",enum:["row","column"]},justifyContent:{type:"string",enum:["start","end","center","between"]},alignItems:{type:"string",enum:["start","end","center"]},marginLeft:{type:"number"},marginRight:{type:"number"},marginTop:{type:"number"},marginBottom:{type:"number"}},required:["id","contents","x","y","width","height"],additionalProperties:!1},TemplateContent:{anyOf:[{$ref:"#/definitions/TemplateTextContent"},{$ref:"#/definitions/TemplateImageContent"},{$ref:"#/definitions/TemplateColorContent"},{$ref:"#/definitions/TemplateReferenceContent"},{$ref:"#/definitions/TemplateSnapshotContent"}]},TemplateTextContent:{type:"object",properties:{kind:{type:"string",const:"text"},text:{type:"string"},textExpression:{type:"string"},textExpressionId:{type:"string"},fontFamily:{type:"string"},fontSize:{type:"number"},fontSizeExpression:{type:"string"},fontSizeExpressionId:{type:"string"},color:{type:"string"},colorExpression:{type:"string"},colorExpressionId:{type:"string"},characters:{type:"array",items:{$ref:"#/definitions/TextCharacter"}},x:{type:"number"},y:{type:"number"},z:{type:"integer"},width:{type:"number"},height:{type:"number"},xExpression:{type:"string"},yExpression:{type:"string"},zExpression:{type:"string"},xExpressionId:{type:"string"},yExpressionId:{type:"string"},zExpressionId:{type:"string"},widthExpression:{type:"string"},heightExpression:{type:"string"},widthExpressionId:{type:"string"},heightExpressionId:{type:"string"},if:{type:"string"},ifId:{type:"string"},repeat:{type:"string"},repeatId:{type:"string"},hidden:{type:"boolean"}},required:["kind","text","fontFamily","fontSize","color","x","y","width","height"],additionalProperties:!1},TextCharacter:{type:"object",properties:{text:{type:"string"}},required:["text"],additionalProperties:!1},TemplateImageContent:{type:"object",properties:{kind:{type:"string",const:"image"},url:{type:"string"},urlExpression:{type:"string"},urlExpressionId:{type:"string"},opacity:{type:"number"},base64:{type:"string"},x:{type:"number"},y:{type:"number"},z:{type:"integer"},width:{type:"number"},height:{type:"number"},xExpression:{type:"string"},yExpression:{type:"string"},zExpression:{type:"string"},xExpressionId:{type:"string"},yExpressionId:{type:"string"},zExpressionId:{type:"string"},widthExpression:{type:"string"},heightExpression:{type:"string"},widthExpressionId:{type:"string"},heightExpressionId:{type:"string"},if:{type:"string"},ifId:{type:"string"},repeat:{type:"string"},repeatId:{type:"string"},hidden:{type:"boolean"}},required:["kind","url","x","y","width","height"],additionalProperties:!1},TemplateColorContent:{type:"object",properties:{kind:{type:"string",const:"color"},color:{type:"string"},colorExpression:{type:"string"},colorExpressionId:{type:"string"},x:{type:"number"},y:{type:"number"},z:{type:"integer"},width:{type:"number"},height:{type:"number"},xExpression:{type:"string"},yExpression:{type:"string"},zExpression:{type:"string"},xExpressionId:{type:"string"},yExpressionId:{type:"string"},zExpressionId:{type:"string"},widthExpression:{type:"string"},heightExpression:{type:"string"},widthExpressionId:{type:"string"},heightExpressionId:{type:"string"},if:{type:"string"},ifId:{type:"string"},repeat:{type:"string"},repeatId:{type:"string"},hidden:{type:"boolean"}},required:["kind","color","x","y","width","height"],additionalProperties:!1},TemplateReferenceContent:{type:"object",properties:{kind:{type:"string",const:"reference"},id:{type:"string"},props:{type:"string"},propsIds:{type:"object",additionalProperties:{type:"string"}},x:{type:"number"},y:{type:"number"},z:{type:"integer"},xExpression:{type:"string"},yExpression:{type:"string"},zExpression:{type:"string"},xExpressionId:{type:"string"},yExpressionId:{type:"string"},zExpressionId:{type:"string"},if:{type:"string"},ifId:{type:"string"},repeat:{type:"string"},repeatId:{type:"string"},hidden:{type:"boolean"}},required:["kind","id","x","y"],additionalProperties:!1},TemplateSnapshotContent:{type:"object",properties:{kind:{type:"string",const:"snapshot"},snapshot:{$ref:"#/definitions/Template"},x:{type:"number"},y:{type:"number"},z:{type:"integer"},xExpression:{type:"string"},yExpression:{type:"string"},zExpression:{type:"string"},xExpressionId:{type:"string"},yExpressionId:{type:"string"},zExpressionId:{type:"string"},hidden:{type:"boolean"}},required:["kind","snapshot","x","y"],additionalProperties:!1}}}),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.styleGuideKey="kfc.json",t.templateModelKey="kfc-model.json",t}return Object(i.d)(t,e),t.prototype.loadStyleGuide=function(){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.e)(this,(function(t){switch(t.label){case 0:return this.styleGuideKey?[4,fetch("https://storage.yorkyao.xyz/"+this.styleGuideKey)]:[3,3];case 1:return[4,t.sent().json()];case 2:e=t.sent(),ce(e)?(this.appState.canvasState.styleGuide=e,this.appState.canvasState.applyCanvasSizeChange()):console.error(ce.errors),t.label=3;case 3:return[2]}}))}))},t.prototype.saveStyleGuide=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.e)(this,(function(e){switch(e.label){case 0:return this.styleGuideKey?[4,fetch("https://storage.yorkyao.xyz/"+this.styleGuideKey,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.appState.canvasState.styleGuide)})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.loadTemplateModel=function(){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.e)(this,(function(t){switch(t.label){case 0:return this.templateModelKey?[4,fetch("https://storage.yorkyao.xyz/"+this.templateModelKey)]:[3,3];case 1:return[4,t.sent().json()];case 2:e=t.sent(),this.appState.templateModel=e,t.label=3;case 3:return[2]}}))}))},t.prototype.saveTemplateModel=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.e)(this,(function(e){switch(e.label){case 0:return this.templateModelKey?[4,fetch("https://storage.yorkyao.xyz/"+this.templateModelKey,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.appState.templateModel)})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.editTemplateModel=function(){this.appState.templateModelEditorVisible=!this.appState.templateModelEditorVisible},t.prototype.generate=function(){return Object(i.b)(this,void 0,void 0,(function(){var e,t,n,a,s,r,o,c;return Object(i.e)(this,(function(p){switch(p.label){case 0:return this.appState.graphicCanvasState?(this.appState.graphicCanvasState=null,[2]):"template"!==this.appState.canvasState.selection.kind?[3,2]:(e=Date.now(),t=[],[4,A(this.appState.canvasState.selection.template,this.appState.canvasState.styleGuide,this.appState.templateModel,{errorHandler:function(e){return t.push(e)},precompiledStyleGuide:this.precompiledStyleGuide,stack:[this.appState.canvasState.selection.template.name||this.appState.canvasState.selection.template.id]})]);case 1:n=p.sent(),console.info(Date.now()-e);try{for(a=Object(i.h)(t),s=a.next();!s.done;s=a.next())r=s.value,console.info(r.stack?r.stack.join(" "):"",r.expression,r.error.message,r.model)}catch(e){o={error:e}}finally{try{s&&!s.done&&(c=a.return)&&c.call(a)}finally{if(o)throw o.error}}this.appState.loadGraphicCanvas(n),p.label=2;case 2:return[2]}}))}))},t.prototype.precompile=function(){this.precompiledStyleGuide=new V(this.appState.canvasState.styleGuide)},t=Object(i.c)([Object(s.a)({render:r,staticRenderFns:o,props:{appState:oe}})],t)}(a.a),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.schema={type:"object",properties:{categories:{type:"array",items:{type:"object",properties:{name:{type:"string"},id:{type:"string"},commodities:{type:"array",items:{type:"object",properties:{name:{type:"string"},id:{type:"string"},description:{type:"string"},image:{type:"string"},prices:{type:"array",items:{type:"string"}}},required:["id","name","prices","description","image"],collapsed:!0}}},required:["id","name","commodities"],collapsed:!0}}},required:["categories"]},t.editorStyle={position:"absolute",right:"0px",left:"0px",top:"50px",backgroundColor:"white",zIndex:1,height:t.appState.canvasState.canvasHeight+"px",overflow:"auto"},t}return Object(i.d)(t,e),t.prototype.updateValue=function(e){e.isValid&&(this.appState.templateModel=e.value)},t=Object(i.c)([Object(s.a)({render:O,staticRenderFns:k,props:{appState:oe}})],t)}(a.a);function ue(e,t,n){var a=document.createElement("canvas");a.width=e.width,a.height=e.height;var s=a.getContext("2d");return s&&(I(e,t),function(e,t,n,a){var s,r,o=[];e?(e.fillStyle="white",e.fillRect(0,0,t.width,t.height)):o.push("ctx.fillStyle = 'white'","ctx.fillRect(0, 0, "+t.width+", "+t.height+")");var c=[];(function e(t,n,a,s,r,o){var c,p;var l=function(t){var i=r.x+Y("x",t.content,{props:o}),c=r.y+Y("y",t.content,{props:o}),p=r.z+Y("z",t.content,{props:o});if("text"===t.kind){var l=t.content;s.push({z:p,index:s.length,action:function(e){var t=o?F(l,{props:o}):l.fontSize,n=o?H(l,{props:o}):l.color,a=l.characters||D(o?N(l,{props:o}):l.text);return e?(e.fillStyle=n,e.textBaseline="top",e.font=t+"px "+l.fontFamily,e.fillText(a.map((function(e){return e.text})).join(""),i,c),[]):["ctx.fillStyle = "+n,"ctx.textBaseline = 'top'","ctx.font = "+t+"px "+l.fontFamily,"ctx.fillText("+a.map((function(e){return e.text})).join("")+", "+i+", "+c+")"]}})}else if("image"===t.kind){var u=t.content,h=o?X(u,{props:o}):u.url,d=o?C("width",u,{props:o}):u.width,v=o?C("height",u,{props:o}):u.height,y=a[h];if(void 0!==u.opacity){var f=W(y,u.opacity);f&&(y=f)}s.push({z:p,index:s.length,action:function(e){return e?(e.drawImage(y,i,c,d,v),[]):["ctx.drawImage("+h+", "+i+", "+c+", "+d+", "+v+")"]}})}else if("color"===t.kind){var m=t.content,g=o?C("width",m,{props:o}):m.width,x=o?C("height",m,{props:o}):m.height,S=o?H(m,{props:o}):m.color;s.push({z:p,index:s.length,action:function(e){return e?(e.fillStyle=S,e.fillRect(i,c,g,x),[]):["ctx.fillStyle = "+m.color,"ctx.fillRect("+i+", "+c+", "+g+", "+x+")"]}})}else if("symbol"===t.kind){var b=t.props?T(t.props,{props:o}):void 0;e(t.symbol,n,a,s,{x:i,y:c,z:p},b)}};try{for(var u=Object(i.h)(ge(t,n)),h=u.next();!h.done;h=u.next()){var d=h.value;l(d)}}catch(e){c={error:e}}finally{try{h&&!h.done&&(p=u.return)&&p.call(u)}finally{if(c)throw c.error}}})(t,n,a,c,{x:0,y:0,z:0}),c.sort((function(e,t){return e.z!==t.z?e.z-t.z:e.index-t.index}));try{for(var p=Object(i.h)(c),l=p.next();!l.done;l=p.next()){var u=l.value.action;o.push.apply(o,Object(i.g)(u(e)))}}catch(e){s={error:e}}finally{try{l&&!l.done&&(r=p.return)&&r.call(p)}finally{if(s)throw s.error}}}(s,e,t,n)),a.toDataURL("image/jpeg")}function he(e,t){return Object(i.b)(this,void 0,void 0,(function(){var n,a,s,r,o;return Object(i.e)(this,(function(c){switch(c.label){case 0:return function e(t,n,a){var s,r;var o=function(t){if(t.hidden)return"continue";if("image"===t.kind){if(t.base64&&a[t.base64])return"continue";if(a[t.url])return"continue";t.base64?a[t.url]=K(t.base64):a[t.url]=K(t.url)}else if("reference"===t.kind){var i=n.find((function(e){return e.id===t.id}));i&&e(i,n,a)}else"snapshot"===t.kind&&e(t.snapshot,n,a)};try{for(var c=Object(i.h)(t.contents),p=c.next();!p.done;p=c.next()){var l=p.value;o(l)}}catch(e){s={error:e}}finally{try{p&&!p.done&&(r=c.return)&&r.call(c)}finally{if(s)throw s.error}}}(e,t,n={}),a=Object.keys(n).map((function(e){return{url:e,resource:n[e]}})),[4,Promise.all(a.map((function(e){return e.resource})))];case 1:for(s=c.sent(),r={},o=0;o<a.length;o++)r[a[o].url]=s[o];return[2,r]}}))}))}var de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),t.prototype.render=function(e){return e("div",{style:{width:this.template.width+"px",height:this.template.height+"px",position:"absolute",userSelect:"none",backgroundColor:"white",zIndex:-2147483584}},[e("symbol-renderer",{props:{reference:this.template,templates:this.templates,content:{x:0,y:0},z:0}})])},t=Object(i.c)([Object(s.a)({props:["template","templates"]})],t)}(a.a),ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return this.referenceProps?C("width",this.reference,{props:this.referenceProps}):this.reference.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.referenceProps?C("height",this.reference,{props:this.referenceProps}):this.reference.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return ee(this.props,"x",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return ee(this.props,"y",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zValue",{get:function(){return this.z+ee(this.props,"z",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),t.prototype.render=function(e){var t,n,a=[];try{for(var s=Object(i.h)(ge(this.reference,this.templates)),r=s.next();!r.done;r=s.next()){var o=r.value;if("text"===o.kind)a.push(e("text-renderer",{props:{content:o.content,props:this.referenceProps,template:this.reference,templates:this.templates,z:this.zValue}}));else if("image"===o.kind)a.push(e("image-renderer",{props:{content:o.content,props:this.referenceProps,template:this.reference,templates:this.templates,z:this.zValue}}));else if("color"===o.kind)a.push(e("color-renderer",{props:{content:o.content,props:this.referenceProps,template:this.reference,templates:this.templates,z:this.zValue}}));else if("symbol"===o.kind){var c=o.content,p=o.props?T(o.props,{props:this.referenceProps}):void 0;a.push(e("symbol-renderer",{props:{reference:o.symbol,templates:this.templates,referenceProps:p,content:c,template:this.reference,props:this.referenceProps,z:this.zValue}}))}}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return e("div",{style:{width:this.width+"px",height:this.height+"px",left:this.x+"px",top:this.y+"px",position:"absolute",userSelect:"none"}},a)},t=Object(i.c)([Object(s.a)({props:["reference","templates","referenceProps","content","template","props","z"]})],t)}(a.a);a.a.component("symbol-renderer",ve);var ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"text",{get:function(){return this.props?N(this.content,{props:this.props}):this.content.text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"characters",{get:function(){return D(this.text)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this.props?F(this.content,{props:this.props}):this.content.fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this.props?H(this.content,{props:this.props}):this.content.color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return ee(this.props,"x",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return ee(this.props,"y",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zValue",{get:function(){return this.z+ee(this.props,"z",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),t.prototype.render=function(e){return e("div",{style:{color:this.color,fontSize:this.fontSize+"px",fontFamily:this.content.fontFamily,position:"absolute",left:this.x+"px",top:this.y+"px",zIndex:this.zValue}},this.characters.map((function(e){return e.text})).join(""))},t=Object(i.c)([Object(s.a)({props:["content","props","template","templates","z"]})],t)}(a.a);a.a.component("text-renderer",ye);var fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"url",{get:function(){return this.props?X(this.content,{props:this.props}):this.content.url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.props?C("width",this.content,{props:this.props}):this.content.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.props?C("height",this.content,{props:this.props}):this.content.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return ee(this.props,"x",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return ee(this.props,"y",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zValue",{get:function(){return this.z+ee(this.props,"z",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageLoader",{get:function(){var e=new xe;return K(this.url).then((function(t){e.result=t})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"base64",{get:function(){if(this.content.base64)return this.content.base64;if(void 0!==this.content.opacity&&this.imageLoader.result){var e=W(this.imageLoader.result,this.content.opacity);if(e)return e.toDataURL()}return this.url},enumerable:!0,configurable:!0}),t.prototype.render=function(e){return e("img",{style:{width:this.width+"px",height:this.height+"px",position:"absolute",left:this.x+"px",top:this.y+"px",zIndex:this.zValue},attrs:{src:this.base64}})},t=Object(i.c)([Object(s.a)({props:["content","props","template","templates","z"]})],t)}(a.a);a.a.component("image-renderer",fe);var me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return this.props?C("width",this.content,{props:this.props}):this.content.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.props?C("height",this.content,{props:this.props}):this.content.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return ee(this.props,"x",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return ee(this.props,"y",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zValue",{get:function(){return this.z+ee(this.props,"z",this.content,this.template,this.templates)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this.props?H(this.content,{props:this.props}):this.content.color},enumerable:!0,configurable:!0}),t.prototype.render=function(e){return e("div",{style:{width:this.width+"px",height:this.height+"px",position:"absolute",left:this.x+"px",top:this.y+"px",backgroundColor:this.color,zIndex:this.zValue}})},t=Object(i.c)([Object(s.a)({props:["content","props","template","templates","z"]})],t)}(a.a);function ge(e,t){var n,a,s,r,o,c,p;return Object(i.e)(this,(function(l){switch(l.label){case 0:n=function(e){var n;return Object(i.e)(this,(function(i){switch(i.label){case 0:return e.hidden?[2,"continue"]:"text"!==e.kind?[3,2]:[4,{kind:"text",content:e}];case 1:return i.sent(),[3,11];case 2:return"image"!==e.kind?[3,4]:[4,{kind:"image",content:e}];case 3:return i.sent(),[3,11];case 4:return"color"!==e.kind?[3,6]:[4,{kind:"color",content:e}];case 5:return i.sent(),[3,11];case 6:return"reference"!==e.kind?[3,9]:(n=t.find((function(t){return t.id===e.id})))?[4,{kind:"symbol",content:e,symbol:n,props:e.props}]:[3,8];case 7:i.sent(),i.label=8;case 8:return[3,11];case 9:return"snapshot"!==e.kind?[3,11]:[4,{kind:"symbol",content:e,symbol:e.snapshot}];case 10:i.sent(),i.label=11;case 11:return[2]}}))},l.label=1;case 1:l.trys.push([1,6,7,8]),a=Object(i.h)(e.contents),s=a.next(),l.label=2;case 2:return s.done?[3,5]:(r=s.value,[5,n(r)]);case 3:l.sent(),l.label=4;case 4:return s=a.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),c={error:o},[3,8];case 7:try{s&&!s.done&&(p=a.return)&&p.call(a)}finally{if(c)throw c.error}return[7];case 8:return[2]}}))}a.a.component("color-renderer",me);var xe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.result=null,t}return Object(i.d)(t,e),t=Object(i.c)([s.a],t)}(a.a),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"canvasStyle",{get:function(){return{position:"absolute",width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",overflow:"hidden",backgroundColor:"#ddd"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"styleGuideStyle",{get:function(){return{transform:"scale("+this.canvasState.styleGuideScale+") translate("+this.canvasState.styleGuideTranslateX+"px, "+this.canvasState.styleGuideTranslateY+"px)",width:this.canvasState.styleGuideWidth+"px",height:this.canvasState.styleGuideHeight+"px"}},enumerable:!0,configurable:!0}),t.prototype.getTemplateStyle=function(e){return{left:e.x+"px",top:e.y+"px",position:"absolute",zIndex:Math.round(e.z||0)}},t.prototype.getNameStyle=function(e){return{position:"absolute",top:"-"+ne+"px",fontSize:"20px",width:(e.name?e.name.length*ne:0)+"px",zIndex:Math.round(e.z||0)}},t=Object(i.c)([Object(s.a)({render:g,staticRenderFns:x,props:{canvasState:ie}})],t)}(a.a);a.a.component("template-renderer",de);var be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"draggingAreaStyle",{get:function(){return{position:"absolute",border:"1px dashed black",left:Math.min(this.canvasState.mousedownX,this.canvasState.mouseupX)+"px",top:Math.min(this.canvasState.mousedownY,this.canvasState.mouseupY)+"px",width:Math.abs(this.canvasState.mousedownX-this.canvasState.mouseupX)+"px",height:Math.abs(this.canvasState.mousedownY-this.canvasState.mouseupY)+"px"}},enumerable:!0,configurable:!0}),t=Object(i.c)([Object(s.a)({render:h,staticRenderFns:d,props:{canvasState:ie}})],t)}(a.a),we=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"selectionRegions",{get:function(){return"template"===this.canvasState.selection.kind?this.canvasState.allTemplateRegions:"content"===this.canvasState.selection.kind?this.canvasState.allContentRegions:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvasStyle",{get:function(){return{position:"absolute",width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",overflow:"hidden"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"styleGuideStyle",{get:function(){return{transform:"scale("+this.canvasState.styleGuideScale+") translate("+this.canvasState.styleGuideTranslateX+"px, "+this.canvasState.styleGuideTranslateY+"px)",width:this.canvasState.styleGuideWidth+"px",height:this.canvasState.styleGuideHeight+"px"}},enumerable:!0,configurable:!0}),t.prototype.getSelectionAreaStyle=function(e){return{left:e.x+"px",top:e.y+"px",width:e.width+"px",height:e.height+"px",position:"absolute",border:1/this.canvasState.styleGuideScale+"px solid green"}},t=Object(i.c)([Object(s.a)({render:S,staticRenderFns:b,props:{canvasState:ie}})],t)}(a.a),je=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.draggingSelectionOffsetX=0,t.draggingSelectionOffsetY=0,t.x=0,t.y=0,t.clipboard={kind:"none"},t.mouseIsDown=!1,t}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"maskStyle",{get:function(){var e;return e=this.getSelectionAreaRelation({x:this.canvasState.mapX(this.x),y:this.canvasState.mapY(this.y)})||this.canvasState.isDraggingForMoving?"move":this.canvasState.isDraggingForSelection?"crosshair":"auto",{position:"absolute",width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",opacity:0,cursor:e}},enumerable:!0,configurable:!0}),t.prototype.wheel=function(e){if(e.ctrlKey){e.preventDefault(),e.stopImmediatePropagation();var t=1;e.deltaY>0?t=.98*this.canvasState.styleGuideScale:e.deltaY<0&&(t=this.canvasState.styleGuideScale/.98);var n=(e.offsetX-this.canvasState.mapX(e.offsetX)*t-this.canvasState.styleGuideWidth/2)/t+this.canvasState.styleGuideWidth/2,i=(e.offsetY-this.canvasState.mapY(e.offsetY)*t-this.canvasState.styleGuideHeight/2)/t+this.canvasState.styleGuideHeight/2;this.canvasState.styleGuideScale=t,this.canvasState.styleGuideTranslateX=n,this.canvasState.styleGuideTranslateY=i}else this.canvasState.styleGuideTranslateX-=e.deltaX/this.canvasState.styleGuideScale,this.canvasState.styleGuideTranslateY-=e.deltaY/this.canvasState.styleGuideScale},t.prototype.mousedown=function(e){if(this.mouseIsDown=!0,this.canvasState.addKind){this.canvasState.action();var t=this.canvasState.mapX(e.offsetX),n=this.canvasState.mapY(e.offsetY);if("template"===this.canvasState.addKind){var i={id:Math.random().toString(),x:t-250,y:n-150,width:500,height:300,contents:[]};this.canvasState.styleGuide.templates.push(i),this.canvasState.selection={kind:"template",template:i}}else{var a=Oe(this.canvasState.styleGuide,{x:t,y:n});if(a)if("text"===this.canvasState.addKind){var s={kind:"text",text:"",color:"#000000",fontFamily:"Aria",fontSize:12,x:t-a.x-50,y:n-a.y-50,width:100,height:100,characters:[]};a.contents.push(s),this.canvasState.selection={kind:"content",content:s,template:a}}else if("image"===this.canvasState.addKind){s={kind:"image",url:"",x:t-a.x-50,y:n-a.y-50,width:100,height:100};a.contents.push(s),this.canvasState.selection={kind:"content",content:s,template:a}}else if("color"===this.canvasState.addKind){s={kind:"color",color:"#000",x:t-a.x-50,y:n-a.y-50,width:100,height:100};a.contents.push(s),this.canvasState.selection={kind:"content",content:s,template:a}}}this.canvasState.addKind=void 0}else{this.canvasState.mousedownX=e.offsetX,this.canvasState.mousedownY=e.offsetY,this.canvasState.mouseupX=e.offsetX,this.canvasState.mouseupY=e.offsetY,this.canvasState.mousePressing=!0;var r=this.getSelectionAreaRelation({x:this.canvasState.mousedownMappedX,y:this.canvasState.mousedownMappedY});this.canvasState.isDraggingForMoving=!!r,r&&(this.draggingSelectionOffsetX=r.offsetX,this.draggingSelectionOffsetY=r.offsetY,this.draggingSelectionContent=r.content)}},t.prototype.mousemove=function(e){if(this.x=e.offsetX,this.y=e.offsetY,this.canvasState.mousePressing&&(this.canvasState.mouseupX=e.offsetX,this.canvasState.mouseupY=e.offsetY),this.canvasState.isDraggingForMoving)if("template"===this.canvasState.selection.kind)this.draggingSelectionContent?(this.draggingSelectionContent.x=this.canvasState.mouseupMappedX-this.draggingSelectionOffsetX,this.draggingSelectionContent.y=this.canvasState.mouseupMappedY-this.draggingSelectionOffsetY):(this.canvasState.selection.template.x=this.canvasState.mouseupMappedX-this.draggingSelectionOffsetX,this.canvasState.selection.template.y=this.canvasState.mouseupMappedY-this.draggingSelectionOffsetY);else if("content"===this.canvasState.selection.kind){if("flex"===this.canvasState.selection.template.display)return;this.canvasState.selection.content.x=this.canvasState.mouseupMappedX-this.draggingSelectionOffsetX,this.canvasState.selection.content.y=this.canvasState.mouseupMappedY-this.draggingSelectionOffsetY}},t.prototype.mouseup=function(e){if(this.mouseIsDown){if(this.mouseIsDown=!1,this.canvasState.mouseupX=e.offsetX,this.canvasState.mouseupY=e.offsetY,this.canvasState.isDraggingForMoving){var t=(this.canvasState.styleGuideTranslateX-this.canvasState.styleGuideWidth/2)*this.canvasState.styleGuideScale+this.canvasState.styleGuideWidth/2,n=(this.canvasState.styleGuideTranslateY-this.canvasState.styleGuideHeight/2)*this.canvasState.styleGuideScale+this.canvasState.styleGuideHeight/2;if(this.canvasState.isDraggingForMoving=!1,this.canvasState.styleGuideTranslateX=(t-this.canvasState.styleGuideWidth/2)/this.canvasState.styleGuideScale+this.canvasState.styleGuideWidth/2,this.canvasState.styleGuideTranslateY=(n-this.canvasState.styleGuideHeight/2)/this.canvasState.styleGuideScale+this.canvasState.styleGuideHeight/2,this.canvasState.mousePressing=!1,this.canvasState.moved)return}var a=this.canvasState.mouseupMappedX,s=this.canvasState.mouseupMappedY;if(this.canvasState.isDraggingForSelection){var r=function(e,t,n){var a,s,r,o={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),width:Math.abs(t.x-n.x),height:Math.abs(t.y-n.y)};try{for(var c=Object(i.h)(U(void 0,e)),p=c.next();!p.done;p=c.next()){var l=p.value,u=[{x:l.x,y:l.y},{x:l.x+l.width,y:l.y+l.height}];(!r||l.z>=r.z)&&B(u,o)&&(r=l)}}catch(e){a={error:e}}finally{try{p&&!p.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}if(r)return r.template;return null}(this.canvasState.styleGuide,{x:a,y:s},{x:this.canvasState.mousedownMappedX,y:this.canvasState.mousedownMappedY});this.canvasState.selection=r?{kind:"template",template:r}:{kind:"none"}}else{var o=function(e,t){var n,a,s,r,o,c;try{for(var p=Object(i.h)(te(void 0,e)),l=p.next();!l.done;l=p.next()){var u=l.value;(!o||u.z>=o.z)&&B(t,u)&&(o=u)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}if(o)return{kind:"template",template:o.template};try{for(var h=Object(i.h)(J(void 0,e)),d=h.next();!d.done;d=h.next()){var v=d.value;(!c||v.z>=c.z)&&B(t,v)&&(c=v)}}catch(e){s={error:e}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(s)throw s.error}}if(c)return{kind:"content",content:c.content,template:c.template};var y=Oe(e,t);if(y)return{kind:"template",template:y};return null}(this.canvasState.styleGuide,{x:a,y:s});o?"content"===o.kind?this.canvasState.selection={kind:"content",content:o.content,template:o.template}:"template"===o.kind&&(this.canvasState.selection={kind:"template",template:o.template}):this.canvasState.selection={kind:"none"}}this.canvasState.mousePressing=!1}},t.prototype.contextmenu=function(e){this.canvasState.contextMenuEnabled=!0,this.canvasState.contextMenuX=e.offsetX,this.canvasState.contextMenuY=e.offsetY,this.canvasState.mousePressing=!1,e.preventDefault()},t.prototype.keydown=function(e){if(e.ctrlKey||e.metaKey)if("c"===e.key)"none"!==this.canvasState.selection.kind&&(this.clipboard=this.canvasState.selection);else if("v"===e.key){if("template"===this.clipboard.kind)if(this.canvasState.action(),"template"===this.canvasState.selection.kind){if(this.clipboard.template!==this.canvasState.selection.template){var t={kind:"reference",id:this.clipboard.template.id,x:0,y:0};this.canvasState.selection.template.contents.push(t),this.canvasState.selection={kind:"content",content:t,template:this.canvasState.selection.template}}}else if("none"===this.canvasState.selection.kind){var n=JSON.parse(JSON.stringify(this.clipboard.template));n.id=Math.random().toString(),n.x=0,n.y=0,this.canvasState.styleGuide.templates.push(n),this.canvasState.selection={kind:"template",template:n}}}else"z"===e.key&&this.canvasState.undo()},t.prototype.getSelectionAreaRelation=function(e){var t,n,a,s,r,o;if("template"===this.canvasState.selection.kind){try{for(var c=Object(i.h)(this.canvasState.allNameRegions),p=c.next();!p.done;p=c.next()){var l=p.value;if(B(e,l))return{offsetX:e.x-l.x,offsetY:e.y-l.y-ne}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}try{for(var u=Object(i.h)(this.canvasState.allTemplateRegions),h=u.next();!h.done;h=u.next()){var d=h.value;if(B(e,d))return d.parent?{offsetX:e.x-d.parent.content.x,offsetY:e.y-d.parent.content.y,content:d.parent.content}:{offsetX:e.x-d.x,offsetY:e.y-d.y}}}catch(e){a={error:e}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(a)throw a.error}}}else if("content"===this.canvasState.selection.kind){var v=this.canvasState.selection.content;try{for(var y=Object(i.h)(this.canvasState.allContentRegions),f=y.next();!f.done;f=y.next()){if(B(e,f.value))return{offsetX:e.x-v.x,offsetY:e.y-v.y,content:void 0}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}}},t=Object(i.c)([Object(s.a)({render:v,staticRenderFns:y,props:{canvasState:ie}})],t)}(a.a);function Oe(e,t){var n,a,s=null;try{for(var r=Object(i.h)(e.templates),o=r.next();!o.done;o=r.next()){var c=o.value;(!s||(c.z||0)>=(s.z||0))&&B(t,c)&&(s=c)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}return s}var ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"contextMenuStyle",{get:function(){return{position:"absolute",left:this.canvasState.contextMenuX+"px",top:this.canvasState.contextMenuY+"px",width:"100px",height:"200px",backgroundColor:"#eee"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maskStyle",{get:function(){return{position:"absolute",width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",opacity:0}},enumerable:!0,configurable:!0}),t.prototype.close=function(e){this.canvasState.contextMenuEnabled=!1,e.stopPropagation()},t.prototype.remove=function(){var e,t,n,a,s=this.canvasState.mapX(this.canvasState.contextMenuX),r=this.canvasState.mapY(this.canvasState.contextMenuY);if(this.canvasState.action(),"template"===this.canvasState.selection.kind)try{for(var o=Object(i.h)(this.canvasState.allTemplateRegions),c=o.next();!c.done;c=o.next()){var p=c.value;if(B({x:s,y:r},p)){if(!p.parent){for(var l=this.canvasState.styleGuide.templates.length-1;l>=0;l--){var u=this.canvasState.styleGuide.templates[l];if(u!==p.template)for(var h=u.contents.length-1;h>=0;h--){var d=u.contents[h];"reference"===d.kind&&d.id===p.template.id&&u.contents.splice(h,1)}else this.canvasState.styleGuide.templates.splice(l,1)}return}p.parent.template.contents.splice(p.parent.index,1)}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else if("content"===this.canvasState.selection.kind)try{for(var v=Object(i.h)(this.canvasState.allContentRegions),y=v.next();!y.done;y=v.next()){var f=y.value;return void f.contents.splice(f.index,1)}}catch(e){n={error:e}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(n)throw n.error}}},t=Object(i.c)([Object(s.a)({render:l,staticRenderFns:u,props:{canvasState:ie}})],t)}(a.a),Ee=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.imageUrl="",t}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"panelStyle",{get:function(){return{height:this.canvasState.canvasHeight+"px",overflow:"auto"}},enumerable:!0,configurable:!0}),t.prototype.changeName=function(e){"template"===this.canvasState.selection.kind&&a.a.set(this.canvasState.selection.template,"name",e.target.value||void 0)},t.prototype.changePosition=function(e,t){if("template"===this.canvasState.selection.kind){var n=+e.target.value;"z"===t&&(n=Math.round(n)),a.a.set(this.canvasState.selection.template,t,n)}},t.prototype.changePositionExpression=function(e,t){if("content"===this.canvasState.selection.kind){if(void 0!==e.literal&&("flex"!==this.canvasState.selection.template.display||"z"===t)){var n=+e.literal;"z"===t&&(n=Math.round(n)),a.a.set(this.canvasState.selection.content,t,n)}a.a.set(this.canvasState.selection.content,t+"Expression",e.expression),a.a.set(this.canvasState.selection.content,t+"ExpressionId",e.expressionId)}},t.prototype.changeSizeExpression=function(e,t){"content"!==this.canvasState.selection.kind||"image"!==this.canvasState.selection.content.kind&&"text"!==this.canvasState.selection.content.kind&&"color"!==this.canvasState.selection.content.kind?"template"===this.canvasState.selection.kind&&(void 0!==e.literal&&(this.canvasState.selection.template[t]=+e.literal),a.a.set(this.canvasState.selection.template,t+"Expression",e.expression||void 0),a.a.set(this.canvasState.selection.template,t+"ExpressionId",e.expressionId)):(void 0!==e.literal&&(this.canvasState.selection.content[t]=+e.literal),a.a.set(this.canvasState.selection.content,t+"Expression",e.expression||void 0),a.a.set(this.canvasState.selection.content,t+"ExpressionId",e.expressionId))},t.prototype.changeHidden=function(e){"content"===this.canvasState.selection.kind&&a.a.set(this.canvasState.selection.content,"hidden",e.target.checked)},t.prototype.changeOpacity=function(e){"content"===this.canvasState.selection.kind&&"image"===this.canvasState.selection.content.kind&&a.a.set(this.canvasState.selection.content,"opacity",+e.target.value)},t.prototype.changeIf=function(e){"content"===this.canvasState.selection.kind&&"snapshot"!==this.canvasState.selection.content.kind&&(a.a.set(this.canvasState.selection.content,"if",e.expression),a.a.set(this.canvasState.selection.content,"ifId",e.expressionId))},t.prototype.changeRepeatExpression=function(e){if("content"===this.canvasState.selection.kind&&"snapshot"!==this.canvasState.selection.content.kind){var t=L(Object(i.a)(Object(i.a)({},this.repeat),{expression:e.expression}));a.a.set(this.canvasState.selection.content,"repeat",t),a.a.set(this.canvasState.selection.content,"repeatId",e.expressionId)}},t.prototype.changeRepeatItemName=function(e){if("content"===this.canvasState.selection.kind&&"snapshot"!==this.canvasState.selection.content.kind){var t=L(Object(i.a)(Object(i.a)({},this.repeat),{itemName:e.target.value}));a.a.set(this.canvasState.selection.content,"repeat",t)}},t.prototype.changeRepeatIndexName=function(e){if("content"===this.canvasState.selection.kind&&"snapshot"!==this.canvasState.selection.content.kind){var t=L(Object(i.a)(Object(i.a)({},this.repeat),{indexName:e.target.value}));a.a.set(this.canvasState.selection.content,"repeat",t)}},Object.defineProperty(t.prototype,"repeat",{get:function(){return"content"===this.canvasState.selection.kind&&"snapshot"!==this.canvasState.selection.content.kind&&this.canvasState.selection.content.repeat?$(this.canvasState.selection.content.repeat):{expression:""}},enumerable:!0,configurable:!0}),t.prototype.changeTextExpression=function(e){"content"===this.canvasState.selection.kind&&"text"===this.canvasState.selection.content.kind&&(void 0!==e.literal&&(this.canvasState.selection.content.text=e.literal),a.a.set(this.canvasState.selection.content,"textExpression",e.expression),a.a.set(this.canvasState.selection.content,"textExpressionId",e.expressionId))},t.prototype.changeFontFamily=function(e){"content"===this.canvasState.selection.kind&&"text"===this.canvasState.selection.content.kind&&(this.canvasState.selection.content.fontFamily=e.target.value)},t.prototype.changeFontSizeExpression=function(e){"content"===this.canvasState.selection.kind&&"text"===this.canvasState.selection.content.kind&&(void 0!==e.literal&&(this.canvasState.selection.content.fontSize=+e.literal),a.a.set(this.canvasState.selection.content,"fontSizeExpression",e.expression),a.a.set(this.canvasState.selection.content,"fontSizeExpressionId",e.expressionId))},t.prototype.changeColorExpression=function(e){"content"!==this.canvasState.selection.kind||"text"!==this.canvasState.selection.content.kind&&"color"!==this.canvasState.selection.content.kind||(void 0!==e.literal&&(this.canvasState.selection.content.color=e.literal),a.a.set(this.canvasState.selection.content,"colorExpression",e.expression),a.a.set(this.canvasState.selection.content,"colorExpressionId",e.expressionId))},t.prototype.changeImageUrlExpression=function(e){"content"===this.canvasState.selection.kind&&"image"===this.canvasState.selection.content.kind&&(void 0!==e.literal&&(this.canvasState.selection.content.url=e.literal),a.a.set(this.canvasState.selection.content,"urlExpression",e.expression),a.a.set(this.canvasState.selection.content,"urlExpressionId",e.expressionId))},t.prototype.debug=function(){"none"===this.canvasState.selection.kind?console.info(this.canvasState):console.info(this.canvasState.selection)},t.prototype.addTemplate=function(){this.canvasState.addKind="template"},t.prototype.addImage=function(){this.canvasState.addKind="image"},t.prototype.addText=function(){this.canvasState.addKind="text"},t.prototype.addColor=function(){this.canvasState.addKind="color"},t.prototype.selectContent=function(e){"none"!==this.canvasState.selection.kind&&(this.canvasState.selection={kind:"content",content:e,template:this.canvasState.selection.template})},t.prototype.changeFlex=function(e,t){"template"===this.canvasState.selection.kind&&("display"===e&&""===t&&(t=void 0),a.a.set(this.canvasState.selection.template,e,t))},t.prototype.extractAsComponent=function(){if("content"===this.canvasState.selection.kind&&("text"===this.canvasState.selection.content.kind||"image"===this.canvasState.selection.content.kind||"color"===this.canvasState.selection.content.kind)){var e=Math.random().toString(),t=this.canvasState.selection.content,n={id:e,contents:[Object(i.a)(Object(i.a)({},t),{x:0,y:0})],x:0,y:0,width:t.width,height:t.height};this.canvasState.styleGuide.templates.push(n);var s=this.canvasState.selection.template.contents.findIndex((function(e){return e===t}));s>=0&&a.a.set(this.canvasState.selection.template.contents,s,{kind:"reference",id:e,x:t.x,y:t.y}),this.canvasState.selection={kind:"template",template:n}}},t.prototype.renderToImage=function(){return Object(i.b)(this,void 0,void 0,(function(){var e,t;return Object(i.e)(this,(function(n){switch(n.label){case 0:return"template"!==this.canvasState.selection.kind?[3,2]:[4,he(this.canvasState.selection.template,this.canvasState.styleGuide.templates)];case 1:e=n.sent(),t=ue(this.canvasState.selection.template,this.canvasState.styleGuide.templates,e),this.imageUrl=t,n.label=2;case 2:return[2]}}))}))},t.prototype.changeParameter=function(e,t){"template"===this.canvasState.selection.kind&&this.canvasState.selection.template.parameters&&(e.target.value?this.canvasState.selection.template.parameters[t]=e.target.value:(this.canvasState.selection.template.parameters.splice(t,1),0===this.canvasState.selection.template.parameters.length&&(this.canvasState.selection.template.parameters=void 0)))},t.prototype.addParameter=function(){"template"===this.canvasState.selection.kind&&(this.canvasState.selection.template.parameters?this.canvasState.selection.template.parameters.push(""):a.a.set(this.canvasState.selection.template,"parameters",[""]))},Object.defineProperty(t.prototype,"parameters",{get:function(){if("content"===this.canvasState.selection.kind&&"reference"===this.canvasState.selection.content.kind){var e=this.canvasState.selection.content.id,t=this.canvasState.styleGuide.templates.find((function(t){return t.id===e}));if(t)return t.parameters}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"propsAst",{get:function(){if("content"===this.canvasState.selection.kind&&"reference"===this.canvasState.selection.content.kind){var e=this.canvasState.selection.content.props;if(e)try{var t=Object(M.c)(Object(M.g)(e));if("ObjectExpression"===t.type)return t}catch(e){}}},enumerable:!0,configurable:!0}),t.prototype.getParameterValue=function(e){if(this.propsAst){var t=Ie(e),n=this.propsAst.properties.find(t);if(n&&"Property"===n.type)return Object(M.e)(n.value)}return""},t.prototype.getParameterExpressionId=function(e){if("content"===this.canvasState.selection.kind&&"reference"===this.canvasState.selection.content.kind&&this.canvasState.selection.content.propsIds)return this.canvasState.selection.content.propsIds[e]},t.prototype.changeParameterValue=function(e,t){var n;if("content"===this.canvasState.selection.kind&&"reference"===this.canvasState.selection.content.kind){var s=e.expression,r=void 0;if(s)try{r=Object(M.c)(Object(M.g)(s))}catch(e){}if(this.propsAst){var o=Ie(t),c=this.propsAst.properties.findIndex(o);if(c>=0){var p=this.propsAst.properties[c];r?p.value=r:this.propsAst.properties.splice(c,1);var l=Object(M.e)(this.propsAst);a.a.set(this.canvasState.selection.content,"props","{}"===l?void 0:l)}else if(r){this.propsAst.properties.push(_e(t,r));l=Object(M.e)(this.propsAst);a.a.set(this.canvasState.selection.content,"props","{}"===l?void 0:l)}}else if(r){l=Object(M.e)({type:"ObjectExpression",properties:[_e(t,r)],range:[0,0]});a.a.set(this.canvasState.selection.content,"props","{}"===l?void 0:l)}else a.a.set(this.canvasState.selection.content,"props",void 0);var u=Object(i.a)(Object(i.a)({},this.canvasState.selection.content.propsIds),((n={})[t]=e.expressionId,n));a.a.set(this.canvasState.selection.content,"propsIds",Object.keys(u).filter((function(e){return void 0!==u[e]})).length>0?u:void 0)}},t=Object(i.c)([Object(s.a)({render:f,staticRenderFns:m,props:{canvasState:ie}})],t)}(a.a);function _e(e,t){return{type:"Property",key:{type:"Identifier",name:e,range:[0,0]},value:t,shorthand:!1,range:[0,0]}}function Ie(e){return function(t){return"Property"===t.type&&("StringLiteral"===t.key.type&&t.key.value===e||"Identifier"===t.key.type&&t.key.name===e)}}var ze=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this.expressionId||""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"presetExpression",{get:function(){var e=this;if(this.id)return this.canvasState.presetExpressions.find((function(t){return t.id===e.id}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTokens",{get:function(){return this.expression?Object(M.g)(this.expression):[]},enumerable:!0,configurable:!0}),t.prototype.emitChange=function(e){this.$emit("change",e)},t.prototype.render=function(e){var t=this,n=this.renderInput(e);return e("span",[e("select",{domProps:{value:this.id?this.id:void 0===this.expression&&this.literalType?"literal":"f(x)"},on:{change:function(e){var n=e.target.value;if("literal"===n)t.emitChange({});else if("f(x)"===n)t.emitChange({expression:t.expression||""});else{var a=t.canvasState.presetExpressions.find((function(e){return e.id===n}));a&&(t.expression&&function(e,t){var n,a,s=Object(M.g)(e.expression);if(s.length!==t.length)return!1;var r=[];try{for(var o=Object(i.h)(e.variables),c=o.next();!c.done;c=o.next()){var p=c.value;"string"!=typeof p&&r.push(p.tokenIndex)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}for(var l=0;l<s.length;l++){var u=s[l],h=t[l];if(u.type!==h.type)return!1;if(!r.includes(l)){if("Identifier"===u.type&&"Identifier"===h.type&&u.name!==h.name)return!1;if("BooleanLiteral"===u.type&&"BooleanLiteral"===h.type&&u.value!==h.value)return!1;if("KeywordToken"===u.type&&"KeywordToken"===h.type&&u.name!==h.name)return!1;if("NumericLiteral"===u.type&&"NumericLiteral"===h.type&&u.value!==h.value)return!1;if("PunctuatorToken"===u.type&&"PunctuatorToken"===h.type&&u.value!==h.value)return!1;if("StringLiteral"===u.type&&"StringLiteral"===h.type&&u.value!==h.value)return!1}}return!0}(a,t.currentTokens)?t.emitChange({expression:t.expression,expressionId:n}):t.emitChange({expression:a.expression,expressionId:n}))}}}},this.renderTypeOptions(e)),e("div",{style:{marginLeft:"20px"}},n)])},t.prototype.renderTypeOptions=function(e){var t=[];return this.literalType&&t.push(e("option",{key:"literal",attrs:{value:"literal"}},"literal")),t.push.apply(t,Object(i.g)([e("option",{key:"f(x)",attrs:{value:"f(x)"}},"f(x)")],this.canvasState.presetExpressions.map((function(t){return e("option",{key:t.id,attrs:{value:t.id}},t.name)})))),t},t.prototype.renderInput=function(e){var t=this,n=this.presetExpression;return n?n.variables.map((function(i){if("string"==typeof i)return e("span",i);var a=t.currentTokens[i.tokenIndex];if("NumericLiteral"===a.type)return e("input",{attrs:{type:"number"},domProps:{value:a.value},style:{width:"50px"},on:{change:function(e){var i=Ge(n.expression,e.target.value,a.range);t.emitChange({expression:i,expressionId:t.expressionId})}}});if("StringLiteral"===a.type)return e("input",{attrs:{type:"text"},domProps:{value:a.value},on:{change:function(e){var i,s,r,o=(i=n.expression,s=e.target.value,r=a.range,i.substring(0,r[0]+1)+s+i.substring(r[1]-1));t.emitChange({expression:o,expressionId:t.expressionId})}}});if("Identifier"===a.type){if(i.enum||i.internal){var s=void 0;return s="component parameters"!==i.internal||"content"!==t.canvasState.selection.kind&&"template"!==t.canvasState.selection.kind?i.enum?i.enum:[]:t.canvasState.selection.template.parameters||[],e("select",{domProps:{value:a.name},on:{change:function(e){var i=Ge(n.expression,e.target.value,a.range);t.emitChange({expression:i,expressionId:t.expressionId})}}},s.map((function(t){return e("option",{key:t,attrs:{value:t}},t)})))}return e("input",{attrs:{type:"text"},domProps:{value:a.name},on:{change:function(e){var i=Ge(n.expression,e.target.value,a.range);t.emitChange({expression:i,expressionId:t.expressionId})}}})}return""})):void 0===this.expression&&this.literalType?[e("input",{attrs:{type:this.literalType},domProps:{value:this.literal},on:{change:function(e){t.emitChange({literal:e.target.value})}}})]:[e("input",{attrs:{type:"text"},domProps:{value:this.expression},on:{change:function(e){t.emitChange({expression:e.target.value})}}})]},t=Object(i.c)([Object(s.a)({props:["literal","literalType","expression","expressionId","canvasState"]})],t)}(a.a);function Ge(e,t,n){return e.substring(0,n[0])+t+e.substring(n[1])}var Pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.d)(t,e),Object.defineProperty(t.prototype,"canvasStyle",{get:function(){return{width:this.canvasState.canvasWidth+"px",height:this.canvasState.canvasHeight+"px",position:"absolute"}},enumerable:!0,configurable:!0}),t=Object(i.c)([Object(s.a)({render:w,staticRenderFns:j,props:{canvasState:ie}})],t)}(a.a);a.a.component("render-layer",Se),a.a.component("dragging-for-selection-layer",be),a.a.component("selection-layer",we),a.a.component("mask-layer",je),a.a.component("context-menu",ke),a.a.component("operation-panel",Ee),a.a.component("expression-input",ze),n.d(t,"App",(function(){return Me})),a.a.component("app-panel",pe),a.a.component("template-model-editor",le),a.a.component("template-editor",Pe);var Me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.appState=new oe,t}return Object(i.d)(t,e),t.prototype.mounted=function(){var e=this;window.addEventListener("resize",(function(){e.appState.resize()}))},t=Object(i.c)([Object(s.a)({render:c,staticRenderFns:p})],t)}(a.a);new Me({el:"#container"})}});
</script>
